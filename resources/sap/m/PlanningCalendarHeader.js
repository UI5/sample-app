/*!
 * OpenUI5
 * (c) Copyright 2026 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","./Toolbar","./AssociativeOverflowToolbar","./Button","./AdditionalTextButton","./Popover","./Title","./ToolbarSpacer","./Label","./OverflowToolbarLayoutData","./SegmentedButton","./PlanningCalendarHeaderRenderer","sap/ui/core/Lib","sap/ui/core/Element","sap/ui/core/Control","sap/ui/unified/Calendar","sap/ui/unified/calendar/CustomMonthPicker","sap/ui/unified/calendar/CustomYearPicker","sap/ui/unified/calendar/IndexPicker","sap/base/i18n/date/CalendarType","sap/base/i18n/date/CalendarWeekNumbering","sap/base/i18n/Localization","sap/ui/core/IconPool","sap/ui/core/InvisibleText","sap/ui/core/library","sap/ui/core/date/UI5Date"],function(e,t,i,o,n,r,a,s,l,c,h,p,d,u,_,g,P,f,y,T,C,w,b,A,S,m){"use strict";var k=_.extend("sap.m.PlanningCalendarHeader",{metadata:{library:"sap.m",properties:{startDate:{type:"object",group:"Data"},pickerText:{type:"string",group:"Data"},pickerTextInSecondaryType:{type:"string",group:"Data"},calendarWeekNumbering:{type:"sap.base.i18n.date.CalendarWeekNumbering",group:"Appearance",defaultValue:null},_primaryCalendarType:{type:"sap.base.i18n.date.CalendarType",group:"Appearance"},_secondaryCalendarType:{type:"sap.base.i18n.date.CalendarType",group:"Appearance"}},aggregations:{actions:{type:"sap.ui.core.Control",multiple:true,singularName:"action"},_actionsToolbar:{type:"sap.m.OverflowToolbar",multiple:false,visibility:"hidden"},_navigationToolbar:{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"},_calendarPicker:{type:"sap.ui.unified.Calendar",multiple:false,visibility:"hidden"},_monthPicker:{type:"sap.ui.unified.internal.CustomMonthPicker",multiple:false,visibility:"hidden"},_yearPicker:{type:"sap.ui.unified.internal.CustomYearPicker",multiple:false,visibility:"hidden"},_indexPicker:{type:"sap.ui.unified.calendar.IndexPicker",multiple:false,visibility:"hidden"}},events:{pressPrevious:{},pressToday:{},pressNext:{},dateSelect:{},cancel:{},viewChange:{}},associations:{currentPicker:{type:"sap.ui.core.Control",multiple:false}}},renderer:p});const v=4;k.prototype.init=function(){const e=this.getId(),r=e+"-NavToolbar",a=d.getResourceBundleFor("sap.m"),s=this.getProperty("_primaryCalendarType");this.setAggregation("_actionsToolbar",new i(e+"-ActionsToolbar",{}).addStyleClass("sapMPCHeadActionsToolbar").addContent(this._getOrCreateTitleControl()).addContent(this._getOrCreateToolbarSpacer()).addContent(this._getOrCreateViewSwitchLabel()).addContent(this._getOrCreateViewSwitch()));this._oPrevBtn=new o(r+"-PrevBtn",{icon:b.getIconURI("slim-arrow-left"),tooltip:a.getText("PCH_NAVIGATE_BACKWARDS"),press:function(){this.firePressPrevious()}.bind(this)});this._oTodayBtn=new o(r+"-TodayBtn",{text:a.getText("PLANNINGCALENDAR_TODAY"),ariaLabelledBy:A.getStaticId("sap.m","PCH_NAVIGATE_TO_TODAY"),press:function(){this.firePressToday()}.bind(this)});this._oNextBtn=new o(r+"-NextBtn",{icon:b.getIconURI("slim-arrow-right"),tooltip:a.getText("PCH_NAVIGATE_FORWARD"),press:function(){this.firePressNext()}.bind(this)});const l=new g(e+"-Cal",{calendarWeekNumbering:this.getCalendarWeekNumbering(),primaryCalendarType:s});l.attachEvent("select",this._handlePickerDateSelect,this);l.attachEvent("cancel",this._handlePickerCancelEvent,this);this.setAggregation("_calendarPicker",l);this._oCalendarAfterRenderDelegate={onAfterRendering:function(){if(this._oPopup&&this._oPopup.isOpen()){l.focus()}}.bind(this)};l.addDelegate(this._oCalendarAfterRenderDelegate);this._oCalendar=l;this.setAssociation("currentPicker",l);const c=new P(e+"-MonthCal",{primaryCalendarType:s});c.attachEvent("select",this._handlePickerDateSelect,this);c.attachEvent("cancel",this._handlePickerCancelEvent,this);this.setAggregation("_monthPicker",c);this._oMonthPicker=c;const h=new f(e+"-YearCal",{primaryCalendarType:s});h.attachEvent("select",this._handlePickerDateSelect,this);h.attachEvent("cancel",this._handlePickerCancelEvent,this);this.setAggregation("_yearPicker",h);this._oYearPicker=h;const p=new y(e+"-IndexPicker");p.attachEvent("select",this._handleIndexPickerSelect,this);this.setAggregation("_indexPicker",p);this._oIndexPicker=p;this._oPickerBtn=new n(r+"-PickerBtn",{text:this.getPickerText(),additionalText:this.getPickerTextInSecondaryType(),ariaHasPopup:S.aria.HasPopup.Dialog,ariaLabelledBy:A.getStaticId("sap.m","PCH_SELECT_RANGE"),press:function(){if(this.fireEvent("_pickerButtonPress",{},true)){let e=this.getStartDate()||m.getInstance(),t;const i=this.getAssociation("currentPicker");const o=u.getElementById(i);if(o instanceof g){t=o.getMinDate();if(t&&t.getTime()>e.getTime()){e=t}}if(o.displayDate){o.displayDate(e)}o.setCalendarWeekNumbering&&o.setCalendarWeekNumbering(this.getCalendarWeekNumbering());this._openCalendarPickerPopup(o)}}.bind(this)});this.setAggregation("_navigationToolbar",new t(r,{content:[this._oPrevBtn,this._oTodayBtn,this._oNextBtn,this._oPickerBtn]}).addStyleClass("sapMPCHeadNavToolbar"))};k.prototype.exit=function(){this._getActionsToolbar().removeAllContent();if(this._oDefaultTitle){this._oDefaultTitle.destroy();this._oDefaultTitle=null}if(this._oTitle){this._oTitle.destroy();this._oTitle=null}if(this._oToolbarSpacer){this._oToolbarSpacer.destroy();this._oToolbarSpacer=null}if(this._oViewSwitch){this._oViewSwitch.destroy();this._oViewSwitch=null}if(this._oViewSwitchLabel){this._oViewSwitchLabel.destroy();this._oViewSwitchLabel=null}if(this._oPopup){if(this._oCalendarAfterRenderDelegate){this._oCalendar.removeDelegate(this._oCalendarAfterRenderDelegate)}this._oPopup.destroy();this._oPopup=null}if(this._oPrevBtn){this._oPrevBtn.destroy();this._oPrevBtn=null}if(this._oNextBtn){this._oNextBtn.destroy();this._oNextBtn=null}};k.prototype.onBeforeRendering=function(){const e=this.getAggregation("_actionsToolbar").getContent()[0].getVisible();const t=this._getOrCreateViewSwitch();const i=!!this.getActions().length||e||t.getItems().length>1;const o=this.getProperty("_secondaryCalendarType");this._getActionsToolbar().setVisible(i);this.setPrimaryCalendarTypeToPickers(this.getProperty("_primaryCalendarType"));if(o){this.setSecondaryCalendarTypeToPickers(o)}};k.prototype._changeTitle=function(e){this.fireEvent("_titleChange",{title:e},true,this);const t=this._getActionsToolbar().getContent()[0];this._getActionsToolbar().removeContent(t);return this._getActionsToolbar().insertContent(e,0)};k.prototype.addAction=function(e){if(!e){return this}if(e.isA("sap.m.Title")){this._changeTitle(e);this._oTitle=e}else{this._getActionsToolbar().addContent(e)}return this.addAggregation("actions",e)};k.prototype.insertAction=function(e,t){if(!e){return this}if(e.isA("sap.m.Title")){this._oTitle=e;return this._changeTitle(e)}this._getActionsToolbar().insertContent(e,t+v);return this.insertAggregation("actions",e,t)};k.prototype.removeAction=function(e){if(!e){return this}if(e.isA("sap.m.Title")&&this._oTitle===e){this._oTitle=null;this._changeTitle(this._getOrCreateTitleControl())}this._getActionsToolbar().removeContent(e);return this.removeAggregation("actions",e)};k.prototype.getTitle=function(){if(this._oTitle){return this._oTitle}return this._getOrCreateTitleControl()};k.prototype.removeAllActions=function(){var e=this._getActionsToolbar(),t=e.getContent();if(t[0]===this._oTitle){this._oTitle=null;this._changeTitle(this._getOrCreateTitleControl())}for(var i=v;i<t.length;i++){e.removeContent(t[i])}return this.removeAllAggregation("actions")};k.prototype.destroyActions=function(){const e=this._getActionsToolbar(),t=e.getContent();for(var i=v;i<t.length;i++){const o=e.removeContent(t[i]);o.destroy()}return this};k.prototype.updatePickerText=function(e){if(!e){return this}this.setPickerText(e.primaryType);this.setPickerTextInSecondaryType(e.secondaryType);return true};k.prototype.setPickerTextInSecondaryType=function(e){this.setProperty("pickerTextInSecondaryType",e);this._oPickerBtn.setAdditionalText(e);return this};k.prototype.setPickerText=function(e){if(!e){return this}this.setProperty("pickerText",e);this._oPickerBtn.setText(e);return this};k.prototype.setPrimaryCalendarTypeToPickers=function(e){this._oCalendar.setPrimaryCalendarType(e);this._oMonthPicker.setPrimaryCalendarType(e);this._oYearPicker.setPrimaryCalendarType(e)};k.prototype.setSecondaryCalendarTypeToPickers=function(e){this._oCalendar.setSecondaryCalendarType(e);this._oMonthPicker.setSecondaryCalendarType(e);this._oYearPicker.setSecondaryCalendarType(e)};k.prototype._getOrCreateTitleControl=function(){if(!this._oDefaultTitle){this._oDefaultTitle=new a(this.getId()+"-Title",{visible:false})}return this._oDefaultTitle};k.prototype._getOrCreateToolbarSpacer=function(){if(!this._oToolbarSpacer){this._oToolbarSpacer=new s(this.getId()+"-Spacer")}return this._oToolbarSpacer};k.prototype._getOrCreateViewSwitch=function(){if(!this._oViewSwitch){this._oViewSwitch=new h(this.getId()+"-ViewSwitch",{layoutData:new c({group:1,priority:e.OverflowToolbarPriority.High})});this._oViewSwitch.attachEvent("selectionChange",this._handleViewSwitchChange,this);this.addDependent(this._oViewSwitch)}return this._oViewSwitch};k.prototype._getOrCreateViewSwitchLabel=function(){if(!this._oViewSwitchLabel){this._oViewSwitchLabel=new l(this.getId()+"-ViewSwitchLabel",{text:d.getResourceBundleFor("sap.m").getText("PCH_VIEW_SWITCH"),visible:false,layoutData:new c({group:1,priority:e.OverflowToolbarPriority.High})});this.addDependent(this._oViewSwitchLabel)}return this._oViewSwitchLabel};k.prototype._convertViewSwitchToSelect=function(){this._oViewSwitch._bForcedSelectMode=true;this._oViewSwitch._toSelectMode();this._updateViewSwitchLabelFor()};k.prototype._convertViewSwitchToSegmentedButton=function(){this._oViewSwitch._bForcedSelectMode=false;this._oViewSwitch._toNormalMode();this._updateViewSwitchLabelFor()};k.prototype._updateViewSwitchLabelFor=function(){const e=this._getOrCreateViewSwitch();const t=this._getOrCreateViewSwitchLabel();const i=e._bInOverflow||e.hasStyleClass("sapMSegBSelectWrapper");if(i){t.setVisible(true);t.setLabelFor(e.getId()+"-select")}else{t.setVisible(false);t.setLabelFor("")}};k.prototype._getTodayButton=function(){return this._oTodayBtn};k.prototype._handlePickerDateSelect=function(){const e=this.getAssociation("currentPicker"),t=u.getElementById(e),i=t.getSelectedDates()[0].getStartDate();this.setStartDate(i);this._closeCalendarPickerPopup();this.fireDateSelect()};k.prototype._handleIndexPickerSelect=function(e){const t=this._oIndexPicker.getSelectedIndex();const i=m.getInstance(this._oCalendar.getMinDate());const o=this._getRelativeInfo();i.setDate(i.getDate()+t*o.iIntervalSize);this.setStartDate(i);this._closeCalendarPickerPopup();this.fireDateSelect()};k.prototype._handleViewSwitchChange=function(e){this.fireViewChange(e.getParameters())};k.prototype._openCalendarPickerPopup=function(e){if(!this._oPopup){this._oPopup=this._createPopup()}const t=this._oPopup.getContent();const i=A.getStaticId("sap.m",this._getPopoverAccessibleName());this._oPopup.removeAllAssociation("ariaLabelledBy");this._oPopup.addAriaLabelledBy(i);if(t.length){const t=this._oPopup.getContent()[0];if(t.isA("sap.ui.unified.internal.CustomYearPicker")){this.setAggregation("_yearPicker",this._oPopup.removeAllContent()[0])}else if(t.isA("sap.ui.unified.internal.CustomMonthPicker")){this.setAggregation("_monthPicker",this._oPopup.removeAllContent()[0])}else if(t.isA("sap.ui.unified.calendar.IndexPicker")){this.setAggregation("_indexPicker",this._oPopup.removeAllContent()[0])}else if(e!==t){this.setAggregation("_calendarPicker",this._oPopup.removeAllContent()[0])}}this._oPopup.addContent(e);this._oPopup.attachAfterOpen(function(){const e=this._oPopup.$();const t=Math.floor((e.width()-this._oPickerBtn.$().width())/2);this._oPopup.setOffsetX(w.getRTL()?t:-t);const i=this._oPickerBtn.$().height();this._oPopup.setOffsetY(this._oPopup._getCalculatedPlacement()==="Top"?i:-i);this._oPopup.getContent()[0].focus()},this);this._oPopup.openBy(this._oPickerBtn.getDomRef())};k.prototype._createPopup=function(){const e=new r({placement:"VerticalPreferredBottom",showHeader:false,showArrow:false,verticalScrolling:false});e.oPopup.setDurations(0,0);e.addDelegate({onsapescape:this.onsapescape},this);this._oPopup=e;return this._oPopup};k.prototype._getPopoverAccessibleName=function(){const e=u.getElementById(this.getAssociation("currentPicker")).getMetadata().getName();switch(e){case"sap.ui.unified.internal.CustomYearPicker":return"DATEPICKER_YEAR_POPOVER_ACCESSIBLE_NAME";case"sap.ui.unified.internal.CustomMonthPicker":return"DATEPICKER_MONTH_POPOVER_ACCESSIBLE_NAME";default:return"DATEPICKER_POPOVER_ACCESSIBLE_NAME"}};k.prototype.onsapescape=function(){if(this._oPopup){this._closeCalendarPickerPopup();if(this._oPickerBtn.getDomRef()){this._oPickerBtn.getDomRef().focus()}}};k.prototype._closeCalendarPickerPopup=function(){if(this._oPopup&&this._oPopup.isOpen()){this._oPopup.close()}};k.prototype._handlePickerCancelEvent=function(){const e=this._oPickerBtn.getDomRef();this.fireCancel();this._closeCalendarPickerPopup();e&&e.focus()};k.prototype._getActionsToolbar=function(){return this.getAggregation("_actionsToolbar")};k.prototype._getNavigationToolbar=function(){return this.getAggregation("_navigationToolbar")};return k});
//# sourceMappingURL=PlanningCalendarHeader.js.map