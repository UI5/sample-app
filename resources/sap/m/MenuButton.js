/*!
 * OpenUI5
 * (c) Copyright 2026 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/ui/core/Control","./Button","./SplitButton","sap/ui/Device","sap/ui/core/Element","sap/ui/core/EnabledPropagator","sap/ui/core/library","sap/ui/core/Popup","sap/ui/core/LabelEnablement","./MenuButtonRenderer","sap/base/i18n/Localization","sap/ui/events/KeyCodes"],function(t,e,o,i,n,s,r,a,l,u,p,c,h){"use strict";var d=t.MenuButtonMode;var f=a.TextDirection;var g=t.ButtonType;var y=l.Dock;var m=["buttonMode","useDefaultActionOnly","width","menuPosition"];var _=e.extend("sap.m.MenuButton",{metadata:{interfaces:["sap.m.IToolbarInteractiveControl"],library:"sap.m",properties:{text:{type:"string",group:"Misc",defaultValue:null},type:{type:"sap.m.ButtonType",group:"Appearance",defaultValue:g.Default},width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:null},enabled:{type:"boolean",group:"Behavior",defaultValue:true},icon:{type:"sap.ui.core.URI",group:"Appearance",defaultValue:null},activeIcon:{type:"sap.ui.core.URI",group:"Misc",defaultValue:null},iconDensityAware:{type:"boolean",group:"Misc",defaultValue:true},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:f.Inherit},buttonMode:{type:"sap.m.MenuButtonMode",group:"Misc",defaultValue:d.Regular},menuPosition:{type:"sap.ui.core.Popup.Dock",group:"Misc",defaultValue:y.BeginBottom},useDefaultActionOnly:{type:"boolean",group:"Behavior",defaultValue:false}},aggregations:{menu:{type:"sap.m.Menu",multiple:false,singularName:"menu"},_button:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"}},associations:{ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{defaultAction:{},beforeMenuOpen:{}},defaultAggregation:"menu",designtime:"sap/m/designtime/MenuButton.designtime",dnd:{draggable:true,droppable:false}},renderer:p});r.call(_.prototype);_.prototype.init=function(){this._initButtonControl()};_.prototype.exit=function(){if(this._sDefaultText){this._sDefaultText=null}if(this._sDefaultIcon){this._sDefaultIcon=null}if(this._lastActionItemId){this._lastActionItemId=null}if(this.getMenu()){this.getMenu().detachClosed(this._menuClosed,this)}};_.prototype.onBeforeRendering=function(){if(!this._sDefaultText){this._sDefaultText=this.getText()}if(!this._sDefaultIcon){this._sDefaultIcon=this.getIcon()}this._updateButtonControl();this._attachMenuEvents()};_.prototype._getTextBtnContentDomRef=function(){return this._getButtonControl()._getTextButton().getDomRef("content")};_.prototype.onAfterRendering=function(){if(this._activeButton){this._activeButton.$().attr("aria-expanded","false");this._activeButton=null}};_.prototype.setButtonMode=function(t){var o=this.getTooltip(),i,n;e.prototype.setProperty.call(this,"buttonMode",t,true);this._getButtonControl().destroy();this._initButtonControl();i=this._getButtonControl();n=i.getMetadata().getAllProperties();for(var r in this.mProperties){if(this.mProperties.hasOwnProperty(r)&&m.indexOf(r)<0&&n.hasOwnProperty(r)){i.setProperty(r,this.mProperties[r],true)}}if(o){i.setTooltip(o)}if(!this._isSplitButton()&&this._sDefaultText){this.setText(this._sDefaultText)}else if(!this.getUseDefaultActionOnly()&&this._getLastSelectedItem()){this.setText(s.getElementById(this._getLastSelectedItem()).getText())}if(!this._isSplitButton()&&this._sDefaultIcon){this.setIcon(this._sDefaultIcon)}else if(!this.getUseDefaultActionOnly()&&this._getLastSelectedItem()){this.setIcon(s.getElementById(this._getLastSelectedItem()).getIcon())}this.invalidate();return this};_.prototype._initButton=function(){var t=new o(this.getId()+"-internalBtn",{width:"100%",ariaHasPopup:a.aria.HasPopup.Menu});t.attachPress(this._handleButtonPress,this);t.onkeydown=this.handleKeydown;return t};_.prototype._initSplitButton=function(){var t=new i(this.getId()+"-internalSplitBtn",{width:"100%"});t.attachPress(this._handleActionPress,this);t.attachArrowPress(this._handleButtonPress,this);t._getArrowButton().onkeydown=this.handleKeydown;return t};_.prototype._initButtonControl=function(){var t;if(this._isSplitButton()){t=this._initSplitButton()}else{t=this._initButton()}this.setAggregation("_button",t,true)};_.prototype._updateButtonControl=function(){this._getButtonControl().setText(this.getText())};_.prototype._getButtonControl=function(){return this.getAggregation("_button")};_.prototype._parseDockAlignment=function(t){let e="Begin";let o="Bottom";if(t.substring(0,5)==="Begin"){e="Begin"}else if(t.substring(0,3)==="End"){e="End"}else if(t.substring(0,4)==="Left"){e="Left"}else if(t.substring(0,5)==="Right"){e="Right"}else if(t.substring(0,6)==="Center"){e="Center"}if(t.substring(t.length-3)==="Top"){o="Top"}else if(t.substring(t.length-6)==="Bottom"){o="Bottom"}else if(t.substring(t.length-6)==="Center"){o="Center"}return{sHorizontalAlign:e,sVerticalAlign:o}};_.prototype._checkViewportCollision=function(t,e,o,i){const n=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,s=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,r=window.innerWidth||document.documentElement.clientWidth,a=window.innerHeight||document.documentElement.clientHeight,l=t-n,u=e-s;return{bFlipHorizontal:l<0||l+o>r,bFlipVertical:u<0||u+i>a}};_.prototype._flipDockAlignment=function(t,e,o,i,n,s){let r=t,a=e,l=0,u=0;if(o){switch(t){case"Begin":r="End";break;case"End":r="Begin";break;case"Left":r="Right";break;case"Right":r="Left";break;case"Center":{const t=window.innerWidth||document.documentElement.clientWidth;const e=n.left+n.width/2;const o=e-s.width/2;if(o<0){l=-o}else if(o+s.width>t){l=t-(o+s.width)}break}}}if(i){switch(e){case"Top":a="Bottom";break;case"Bottom":a="Top";break;case"Center":{const t=window.innerHeight||document.documentElement.clientHeight;const e=n.top+n.height/2;const o=e-s.height/2;if(o<0){u=-o}else if(o+s.height>t){u=t-(o+s.height)}break}}}return{sHorizontalAlign:r,sVerticalAlign:a,iCenterOffsetX:l,iCenterOffsetY:u}};_.prototype._adjustPopoverPosition=function(t,e,o){let i,n,s=0,r=0,{sHorizontalAlign:a,sVerticalAlign:l}=this._parseDockAlignment(t);const u=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,p=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,h=e._oControl.getDomRef(),d=h.getBoundingClientRect(),f=c.getRTL();const g=this._calculatePopoverPosition(a,l,o,d,u,p,f);i=g.iLeft;n=g.iTop;s=g.iOffsetLeft;r=g.iOffsetTop;const y=this._checkViewportCollision(i+s,n+r,d.width,d.height);if(y.bFlipHorizontal||y.bFlipVertical){const t=this._flipDockAlignment(a,l,y.bFlipHorizontal,y.bFlipVertical,o,d);a=t.sHorizontalAlign;l=t.sVerticalAlign;const e=this._calculatePopoverPosition(a,l,o,d,u,p,f);i=e.iLeft;n=e.iTop;s=e.iOffsetLeft;r=e.iOffsetTop;if(t.iCenterOffsetX!==0){s+=t.iCenterOffsetX}if(t.iCenterOffsetY!==0){r+=t.iCenterOffsetY}}h.style.left=Math.round(i+s)+"px";h.style.top=Math.round(n+r)+"px";h.style.right="";h.style.bottom="";e.detachEvent("afterOpen",this._adjustPopoverPosition)};_.prototype._calculatePopoverPosition=function(t,e,o,i,n,s,r){let a,l,u=0,p=0;const c=t==="Left"||t==="Right";switch(t){case"Begin":a=r?o.right+n-i.width:o.left+n;u=r?-1:1;break;case"End":a=r?o.left+n:o.right+n-i.width;u=r?1:-1;break;case"Left":a=o.left+n-i.width;u=-2;break;case"Right":a=o.right+n;u=2;break;default:{const t=o.left+o.width/2+n;a=t-i.width/2}}switch(e){case"Top":l=c?o.top+o.height+s-i.height:o.top+s-i.height;p=c?-5:2;break;case"Bottom":l=c?o.top+s:o.top+o.height+s;p=c?5:-2;break;default:{const t=o.top+o.height/2+s;l=t-i.height/2}}return{iLeft:a,iTop:l,iOffsetLeft:u,iOffsetTop:p}};_.prototype._destroyAnchorElement=function(t){if(this._menuButtonAnchor&&this._menuButtonAnchor.parentNode){this._menuButtonAnchor.parentNode.removeChild(this._menuButtonAnchor)}this._menuButtonAnchor=null;t&&t.detachEvent("afterClose",this._destroyAnchorElement)};_.prototype._createAnchorElement=function(t){this._destroyAnchorElement();const e=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,o=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,i=t.left+t.width/2+e,n=t.top+t.height/2+o,s=document.createElement("div");s.style.position="absolute";s.style.width="1px";s.style.height="1px";s.style.left=Math.round(i)+"px";s.style.top=Math.round(n)+"px";s.style.zIndex="2147483647";s.style.pointerEvents="none";s.setAttribute("aria-hidden","true");s.className="sapMMenuButtonAnchor";document.body.appendChild(s);this._menuButtonAnchor=s};_.prototype._createMenuPositionAnchor=function(t,e){if(!t||!e||!y[t]){return}const o=this.getDomRef().getBoundingClientRect();this._createAnchorElement(o);e.attachEvent("afterOpen",this._adjustPopoverPosition.bind(this,t,e,o));e.attachEvent("afterClose",this._destroyAnchorElement.bind(this,e))};_.prototype._handleButtonPress=function(t){var e=this.getMenu();this.fireBeforeMenuOpen();if(!e){return}if(e.isOpen()&&!t.getParameter("keyboard")){e.close();this._bPopupOpen=false;return}if(!e.getTitle()){e.setTitle(this.getText())}var o=[this,t.getParameter("keyboard")];var i=e._getPopover();var s=this.getMenuPosition();if(s&&i){this._createMenuPositionAnchor(s,i)}e.openBy.apply(e,o);if(this.getMenu()){this._bPopupOpen=true}this._writeAriaAttributes();if(this._isSplitButton()&&!n.system.phone){this._getButtonControl().setArrowState(true)}};_.prototype._handleActionPress=function(){var t=this._getLastSelectedItem(),e;if(!this.getUseDefaultActionOnly()&&t){e=s.getElementById(t);this.getMenu().fireItemSelected({item:e})}else{this.fireDefaultAction()}};_.prototype._menuClosed=function(){var t=this._getButtonControl(),e=t,o=this.getMenu(),i=o&&o._getPopover();if(this._isSplitButton()){t.setArrowState(false);e=t._getArrowButton()}if(i&&!i.isOpen()){this._bPopupOpen=false}e.$().removeAttr("aria-controls");e.$().attr("aria-expanded","false")};_.prototype._menuItemSelected=function(t){var e=t.getParameter("item");this.fireEvent("_menuItemSelected",{item:e});this._bPopupOpen=false;if(!this._isSplitButton()||this.getUseDefaultActionOnly()||!e){return}this._lastActionItemId=e.getId();!!this._sDefaultText&&this.setText(e.getText());!!this._sDefaultIcon&&this.setIcon(e.getIcon())};_.prototype._getLastSelectedItem=function(){return this._lastActionItemId};_.prototype._attachMenuEvents=function(){if(this.getMenu()){this.getMenu().attachClosed(this._menuClosed,this);this.getMenu().attachItemSelected(this._menuItemSelected,this)}};_.prototype._isSplitButton=function(){return this.getButtonMode()===d.Split};_.prototype.setProperty=function(t,o,i){function n(t){var e=[g.Up,g.Back,g.Unstyled];return e.indexOf(t)!==-1}if(t==="type"&&n(o)){return this}if(t==="text"){this._sDefaultText=o}switch(t){case"activeIcon":case"iconDensityAware":case"textDirection":case"visible":case"enabled":this._getButtonControl().setProperty(t,o);break}return e.prototype.setProperty.apply(this,arguments)};_.prototype.setTooltip=function(t){this._getButtonControl().setTooltip(t);return e.prototype.setTooltip.apply(this,arguments)};_.prototype.setText=function(t){e.prototype.setProperty.call(this,"text",t);this._getButtonControl().setText(t);return this};_.prototype.setType=function(t){e.prototype.setProperty.call(this,"type",t);this._getButtonControl().setType(t);return this};_.prototype.setIcon=function(t){e.prototype.setProperty.call(this,"icon",t);this._getButtonControl().setIcon(t);return this};_.prototype.addAriaLabelledBy=function(t){this.getAggregation("_button").addAssociation("ariaLabelledBy",t);return e.prototype.addAssociation.call(this,"ariaLabelledBy",t)};_.prototype.addAriaDescribedBy=function(t){this.getAggregation("_button").addAssociation("ariaDescribedBy",t);return e.prototype.addAssociation.call(this,"ariaDescribedBy",t)};_.prototype.removeAriaLabelledBy=function(t){this.getAggregation("_button").removeAssociation("ariaLabelledBy",t);return e.prototype.removeAssociation.call(this,"ariaLabelledBy",t)};_.prototype.removeAriaDescribedBy=function(t){this.getAggregation("_button").removeAssociation("ariaDescribedBy",t);return e.prototype.removeAssociation.call(this,"ariaDescribedBy",t)};_.prototype.removeAllAriaLabelledBy=function(t){this.getAggregation("_button").removeAllAssociation("ariaLabelledBy");return e.prototype.removeAllAssociation.call(this,"ariaLabelledBy")};_.prototype.removeAllAriaDescribedBy=function(){this.getAggregation("_button").removeAllAssociation("ariaDescribedBy");return e.prototype.removeAllAssociation.call(this,"ariaDescribedBy")};_.prototype.getFocusDomRef=function(){return this._getButtonControl().getDomRef()};_.prototype.onsapup=function(t){const e=t?.keyCode;const o=e===h?.ARROW_DOWN||e===h?.ARROW_UP;const i=o&&!t?.ctrlKey&&(t?.altKey||t?.metaKey);if(o&&!i){return}this.openMenuByKeyboard();t.stopPropagation()};_.prototype.onsapdown=function(t){const e=t?.keyCode;const o=e===h?.ARROW_DOWN||e===h?.ARROW_UP;const i=o&&!t?.ctrlKey&&(t?.altKey||t?.metaKey);if(o&&!i){return}this.openMenuByKeyboard();t.stopPropagation()};_.prototype.onsapupmodifiers=function(t){this.openMenuByKeyboard();t.stopPropagation()};_.prototype.onsapdownmodifiers=function(t){this.openMenuByKeyboard();t.stopPropagation()};_.prototype.onsapshow=function(t){this.openMenuByKeyboard();!!t&&t.preventDefault()};_.prototype.ontouchstart=function(){const t=this.getMenu(),e=t&&t._getPopover();this._bPopupOpen=t&&e&&e.isOpen()};_.prototype.handleKeydown=function(t){if((t.keyCode===h.ENTER||t.keyCode===h.TAB)&&this._bPopupOpen){this.getMenu().close();this._bPopupOpen=false}o.prototype.onkeydown.call(this,t)};_.prototype.openMenuByKeyboard=function(){if(!this._isSplitButton()){this._handleButtonPress(Object.create(null,{getParameter:{value:function(){return true}}}))}};_.prototype._writeAriaAttributes=function(){var t=this._getButtonControl(),e=this._isSplitButton()?t._getArrowButton():t,o=this.getMenu();if(o){e.$().attr("aria-controls",o.getDomRefId());e.$().attr("aria-expanded","true")}};_.prototype._getToolbarInteractive=function(){return true};_.prototype.getIdForLabel=function(){return this.getId()+"-internalBtn"};_.prototype._ensureBackwardsReference=function(){var t=this._getButtonControl(),e=t.getAriaLabelledBy(),o=u.getReferencingLabels(this);o.forEach(function(o){if(e&&e.indexOf(o)===-1){t.addAriaLabelledBy(o)}});return this};return _});
//# sourceMappingURL=MenuButton.js.map