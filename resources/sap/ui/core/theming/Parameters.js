/*!
 * OpenUI5
 * (c) Copyright 2026 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/future","sap/base/Log","sap/base/util/syncFetch","sap/ui/base/OwnStatics","sap/ui/core/Theming","sap/ui/core/theming/ThemeManager","sap/ui/util/_URL"],function(e,t,n,r,s,a,i){"use strict";const o=sap.ui.loader._.getSyncCallBehavior();const{attachChange:c}=r.get(s);const{getAllLibraryInfoObjects:l}=r.get(a);const u={};let f={};let d=null;const h=new Set;const g=[];const m=/url[\s]*\('?"?([^\'")]*)'?"?\)/;const p=new URL(sap.ui.require.toUrl(""),document.baseURI).origin;const y={};function b(e,t){const n=m.exec(e);if(n){const r=new i(n[1],t);if(!r.isAbsolute()){const t=r.href;e="url('"+t+"')"}}return e}function w(e,t){if(typeof e["default"]==="object"){e=e["default"]}for(const n in e){if(typeof f[n]==="undefined"){f[n]=b(e[n],t)}}}function U(e){const t=l();new Set([...t.keys()]).difference(h).forEach(n=>e(t.get(n)))}function L(n,r){const s=A(n);if(!n.finishedLoading&&r){t.warning("Parameters have been requested but theme is not applied, yet.","sap.ui.core.theming.Parameters")}if(n.finishedLoading){const t=document.getElementById(n.linkId);const a=window.getComputedStyle(t).getPropertyValue("background-image");const i=/\(["']?data:text\/plain;utf-8,(.*?)['"]?\)$/i.exec(a);if(i&&i.length>=2){let t=i[1];if(t.charAt(0)!=="{"&&t.charAt(t.length-1)!=="}"){try{t=decodeURIComponent(t)}catch(t){e.warningThrows("Could not decode theme parameters URI from "+s.styleSheetUrl,{cause:t})}}try{const e=JSON.parse(t);w(e,s.themeBaseUrl);h.add(n.id);return true}catch(t){e.warningThrows("Could not parse theme parameters from "+s.styleSheetUrl+".",{cause:t,suffix:"Loading library-parameters.json as fallback solution."})}}if(r){return false}else{h.add(n.id);return true}}return false}function P(e){const n=A(e);if(!L(e,true)){const r=n.styleSheetUrl.replace(/\/(?:css_variables|library)([^\/.]*)\.(?:css|less)($|[?#])/,function(e,t,n){return"/library-parameters.json"+(n?n:"")});if(o===2){t.error("[nosync] Loading library-parameters.json ignored",r,"sap.ui.core.theming.Parameters");return}else if(o===1){t.error("[nosync] Loading library-parameters.json with sync XHR",r,"sap.ui.core.theming.Parameters")}const s=new URL(n.themeBaseUrl).origin;const a=y[s];let i=[];if(a===undefined){if(r.startsWith(p)){i=[false,true]}else{i=[true,false]}}else{i=[a]}T(r,n.themeBaseUrl,i);h.add(e.id)}}function A(t){if(!t.getUrl().url&&!t.cssLinkElement){e.warningThrows(`sap.ui.core.theming.Parameters: Could not find stylesheet element with ID "${t.id}"`);return undefined}const n=t.getUrl().url||t.cssLinkElement?.getAttribute("href");const r=t.getUrl().baseUrl.replace(/\/[^\/]*$/,"/");return{themeBaseUrl:r,styleSheetUrl:n}}function T(r,s,a){const i={Accept:n.ContentTypes.JSON};const o=a.shift();if(o){i["X-Requested-With"]="XMLHttpRequest"}function c(n){e.errorThrows("Could not load theme parameters from: "+r,{cause:n});if(a.length>0){t.warning("Initial library-parameters.json request failed ('withCredentials="+o+"'; sUrl: '"+r+"').\n"+"Retrying with 'withCredentials="+!o+"'.","sap.ui.core.theming.Parameters");T(r,s,a)}}try{const e=n(r,{credentials:o?"include":"omit",headers:i});if(e.ok){const t=e.json();const n=new URL(s).origin;y[n]=o;w(t,s)}else{throw new Error(e.statusText||e.status)}}catch(e){c(e)}}function j(e,t){if(t){U(L)}else{U(P)}let n=f[e];if(!n){const t=e.indexOf(":");if(t!=-1){const r=e.slice(t+1);n=f[r]}}return n}u.get=function(n){let r,a;let i;let o;const c=function(e){return e.callback===r};if(!d){d=s.getTheme()}if(arguments.length===0){t.warning("[FUTURE FATAL] Legacy variant usage of sap.ui.core.theming.Parameters.get API detected. Do not use the Parameters.get() API to retrieve ALL theming parameters, "+"as this will lead to unwanted synchronous requests. "+"Use the asynchronous API variant instead and retrieve a fixed set of parameters.","LegacyParametersGet","sap.ui.support",function(){return{type:"LegacyParametersGet"}});U(P);return Object.assign({},f)}if(!n){return undefined}if(n instanceof Object&&!Array.isArray(n)){if(!n.name){e.warningThrows("sap.ui.core.theming.Parameters: Get was called with an object argument without one or more parameter names.");return undefined}r=n.callback;o=n._restrictedParseUrls||false;a=typeof n.name==="string"?[n.name]:n.name;i=true}else{e.warningThrows(`Legacy variant usage of sap.ui.core.theming.Parameters.get API detected for parameter(s): '${n.join?.(", ")??n}'.`,{suffix:"This could lead to bad performance and additional synchronous XHRs, as parameters might not be available yet. Use asynchronous variant instead."},"LegacyParametersGet","sap.ui.support",function(){return{type:"LegacyParametersGet"}});if(typeof n==="string"){a=[n]}else{a=n}}const l={};for(const e of a){const t=j(e,i);if(!i||t){l[e]=t}}if(i&&r&&Object.keys(l).length!==a.length){const e=function(){s.detachApplied(e);const i=this.get({name:n.name});if(!i||typeof i==="object"&&Object.keys(i).length!==a.length){t.error(`sap.ui.core.theming.Parameters: The following parameters could not be found: "${a.length===1?a[0]:a.filter(e=>i&&!Object.hasOwn(i,e))}"`)}r(i);g.splice(g.findIndex(c),1)}.bind(this);const i=g.findIndex(c);if(i>=0){s.detachApplied(g[i].eventHandler);g[i].eventHandler=e}else{g.push({callback:r,eventHandler:e})}s.attachApplied(e);return undefined}if(o){I(l)}return a.length===1?l[a[0]]:l};function I(e){for(const t in e){if(Object.hasOwn(e,t)){let n=e[t];const r=m.exec(n);if(r){n=r[1]}else if(n==="''"||n==="none"){n=null}e[t]=n}}}u.reset=function(){v(true)};function v(){const e=arguments[0]===true;if(e||s.getTheme()!==d){d=s.getTheme();h.clear();f={}}}u._getThemeImage=function(e,t){e=e||"sapUiGlobalLogo";let n=u.get(e);if(n){const e=m.exec(n);if(e){n=e[1]}else if(n==="''"||n==="none"){n=null}}if(t&&!n){return sap.ui.require.toUrl("sap/ui/core/themes/base/img/1x1.gif")}return n};c(v);return u},true);
//# sourceMappingURL=Parameters.js.map