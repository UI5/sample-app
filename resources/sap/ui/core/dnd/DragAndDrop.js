/*!
 * OpenUI5
 * (c) Copyright 2026 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["../library","sap/base/i18n/Localization","sap/ui/Device","sap/ui/core/Element","sap/ui/core/StaticArea","../UIArea","sap/ui/core/Popup","sap/ui/thirdparty/jquery"],function(e,t,r,n,o,i,a,jQuery){"use strict";var f=e.dnd.RelativeDropPosition;var s={},g=null,u=null,l=null,c=[],d=[],p=null,D,h,v,m,w={},b,A,C,E;function y(e,t){if(!e){return}if(e.addStyleClass){e.addStyleClass(t)}else{e.$().addClass(t)}}function x(e,t){if(!e){return}if(e.removeStyleClass){e.removeStyleClass(t)}else{e.$().removeClass(t)}}function T(e,t){var r=n.closestTo(e.target,true);if(!r){return}var o=new jQuery.Event(null,e);o.type=t;r.getUIArea()._handleEvent(o)}function I(e,t,r,n=true){const o=new Event(e);if(r){o.dataTransfer=r}const i=new jQuery.Event(o);i.setMark("simulated",n);t.$().trigger(i);return i}function S(e,t){let r=[];const n=e.getParent();const o=n.getMetadata();const i=e.sParentAggregationName;const a=o.getAllAggregations();if(a[i]){r=n[a[i]._sGetter]()}else{const e=o.getAllPrivateAggregations();if(e[i]){r=n.getAggregation(i)}}const f=r.indexOf(e);if(t=="next"){return r.slice(f+1).find(e=>e.getDomRef())}return r.slice(0,f).findLast(e=>e.getDomRef())}function k(e){if(e.isMarked()||!(e.ctrlKey||e.metaKey)||!e.code?.startsWith("Arrow")){return}const t=e.target;const r=t.hasAttribute("data-sap-ui-draghandle")?n.closestTo(t,true):n.getElementById(t.id);if(!r){return}const o=n.getElementById(r.$().closest("[data-sap-ui-draggable]").attr("id"));const i=o?.getParent();const a=o?.sParentAggregationName;if(!i||!a){return}const f=[];const s=[];i.getDragDropConfig().forEach(e=>{if(!e.getKeyboardHandling()){return}if(e.isA("sap.ui.core.dnd.IDropInfo")&&e.getTargetAggregation()==a&&e.getDropPosition()=="Between"){f.push(e)}if(e.isA("sap.ui.core.dnd.IDragInfo")&&e.getSourceAggregation()==a){s.push(e.getGroupName())}});const g=f.find(e=>s.includes(e.getGroupName()));if(!g){return}return{oDragControl:o,oDropConfig:g}}function N(e){return!e.disabled&&/^(input|textarea)$/.test(e.localName)}function M(e,t){if(!e||!e.getDragGhost){return}var r=e.getDragGhost();if(!r){return}if(!h){h=jQuery('<div class="sapUiDnDGhostContainer"></div>');jQuery(document.body).append(h)}h.append(r);window.setTimeout(function(){h.empty()},0);var n=t.originalEvent;n.dataTransfer.setDragImage(r,n.offsetX,n.offsetY)}function P(e){var t={},r,n=e.originalEvent.dataTransfer,o=function(e,t){n.setData(e,t)};return{setData:function(e,r){r=""+r;t[e]=r;o(e,r)},getData:function(e){return t[e]},setTextData:function(e){e=""+e;t["text/plain"]=e;t["text"]=e;o("text/plain",e);o("text",e)},getTextData:function(){return t["text/plain"]},setComplexData:function(e,r){t[e]=r},getComplexData:function(e){return t[e]},getIndicator:function(){return D&&D[0]},setIndicatorConfig:function(e){r=e},getIndicatorConfig:function(){return r},getDragControl:function(){return g},getDropControl:function(){return l},setDropControl:function(e){l=e},getDropInfo:function(){return d[0]||null},getDropPosition:function(){return v}}}function R(){O();g=u=l=p=null;v="";E=false;c=[];d=[]}function B(){if(D){return D}D=jQuery("<div class='sapUiDnDIndicator'></div>");jQuery(o.getDomRef()).append(D);return D}function O(){if(D){D.removeAttr("style");D.hide();w={}}}function U(e,r,n,o,i){if(!r){return}const s=e.getMark("simulated");if(s){if(s=="prev"){return f.Before}if(s=="next"){return f.After}}var g=l.getDropAreaRect?l.getDropAreaRect(o):r.getBoundingClientRect(),u=e.dragSession&&e.dragSession.getIndicatorConfig(),c=window.scrollY,d=window.scrollX,p=B(),D,h={},v={top:g.top+c,bottom:g.bottom+c,left:g.left+d,right:g.right+d,width:g.width,height:g.height};if(!n||n=="On"){D=f.On;o=""}else if(o=="Horizontal"){var m=e.pageX-v.left;h.height=v.height;h.top=v.top;if(n=="Between"){h.width="";if(m<v.width*.5){D=f.Before;h.left=v.left}else{D=f.After;h.left=v.right}}else if(n=="OnOrBetween"){if(m<v.width*.25){D=f.Before;h.left=v.left;h.width=""}else if(m>v.width*.75){D=f.After;h.left=v.right;h.width=""}else{D=f.On}}if(D!=f.On&&t.getRTL()){D=D==f.After?f.Before:f.After}}else{var b=e.pageY-v.top;h.width=v.width;h.left=v.left;if(n=="Between"){h.height="";if(b<v.height*.5){D=f.Before;h.top=v.top}else{D=f.After;h.top=v.bottom}}else if(n=="OnOrBetween"){if(b<v.height*.25){D=f.Before;h.top=v.top;h.height=""}else if(b>v.height*.75){D=f.After;h.top=v.bottom;h.height=""}else{D=f.On}}}if(i||u?.display=="none"){return D}if(D==f.On){h.top=v.top;h.left=v.left;h.width=v.width;h.height=v.height;n=D}else{n="Between"}if(w.top!=h.top||w.left!=h.left||w.width!=h.width||w.height!=h.height){p.attr("data-drop-layout",o);p.attr("data-drop-position",n);p.css(Object.assign(h,u));p.css("z-index",Math.max(a.getNextZIndex()+1,99));p.show();w=h}return D}function L(e){var t=e.getParent(),r=e.getDragDropConfig?e.getDragDropConfig():[],n=t&&t.getDragDropConfig?t.getDragDropConfig():[];return r.concat(n)}function G(e){var t=L(e);return t.filter(function(t){return t.isDraggable(e)})}function W(e,t,r){var n=L(e);t=t||[];return n.filter(function(e){return!e.isA("sap.ui.core.dnd.IDragInfo")}).concat(t).filter(function(n){if(!n.isDroppable(e,r)){return false}var o=n.getGroupName();if(!o){return true}return t.some(function(e){return e.getGroupName()==o})})}function $(e,t){e.preventDefault();if(g){var r=t.getDropEffect().toLowerCase();e.originalEvent.dataTransfer.dropEffect=r}}function z(e,t,r,n){var o=t.getTargetAggregation();if(!o){return U(e,r.getDomRef(),undefined,undefined,n)}var i;if(e.getMark("DragWithin")==o){i=r.getDomRefForSetting(o)}i=i||r.getDomRef();return U(e,i,t.getDropPosition(true),t.getDropLayout(true),n)}s.preprocessEvent=function(e){if(p&&e.type.indexOf("dr")==0){e.dragSession=p;if(C){C=clearTimeout(C)}}var t="onbefore"+e.type;if(s[t]){s[t](e)}};s.postprocessEvent=function(e){var t="onafter"+e.type;if(s[t]){s[t](e)}};s.onbeforekeydown=function(e){if(k(e)){e.setMark("dnd")}};s.onafterkeydown=function(e){if(!e.getMark("dnd")){return}let r,n;const{oDragControl:o,oDropConfig:i}=k(e);const a=i.getDropLayout(true);if(a=="Horizontal"&&(e.code=="ArrowRight"||e.code=="ArrowLeft")){const i=t.getRTL()?"prev":"next";const a=t.getRTL()?"next":"prev";r=e.code=="ArrowRight"?i:a;n=S(o,r);e.preventDefault()}if(a=="Vertical"&&(e.code=="ArrowDown"||e.code=="ArrowUp")){r=e.code=="ArrowDown"?"next":"prev";n=S(o,r);e.preventDefault()}if(!n){return}const f=new DataTransfer;const s=I("dragstart",o,f,r);if(s.isDefaultPrevented()||s.isMarked("NonDraggable")){return}const g=I("dragenter",n,f,r);if(!g.isMarked("NonDroppable")){I("drop",n,f,r)}I("dragend",o,f,r)};s.onbeforemousedown=function(e){if(r.browser.firefox&&N(e.target)){b=jQuery(e.target).closest("[data-sap-ui-draggable=true]").prop("draggable",false)[0]}};s.onbeforemouseup=function(e){if(b){b.draggable=true;b=null}};s.onbeforedragstart=function(e){if(!e.target.draggable){return}if(N(document.activeElement)){e.target.getAttribute("data-sap-ui-draggable")&&e.preventDefault();return}g=n.closestTo(e.target,true);if(!g){return}c=G(g);if(!c.length){return}if(r.browser.mobile&&!e.originalEvent.dataTransfer.getData("text")){e.originalEvent.dataTransfer.setData("text"," ")}e.dragSession=p=P(e)};s.onafterdragstart=function(e){if(!c.length||e.isDefaultPrevented()){R();return}c=e.isMarked("NonDraggable")?[]:c.filter(function(t){return t.fireDragStart(e)});if(!c.length){e.preventDefault();R();return}if(e.simulated){return}M(g,e);y(g,"sapUiDnDDragging");if(jQuery(e.target).closest(".sapUiScrollDelegate")[0]){jQuery("html").addClass("sapUiDnDNoScrolling")}};s.onbeforedragenter=function(e){var t=n.closestTo(e.target,true);if(t&&u===t){e.setMark("DragWithin","SameControl")}else{m=Date.now();u=t}var r=[],o;l=t;for(var i=0;i<20&&l;i++){r=W(l,c,e);if(r.length){break}o=l.getDomRef();o=o&&o.parentElement;l=n.closestTo(o,true)}if(e.getMark("DragWithin")!="SameControl"){d=r;if(p){p.setIndicatorConfig(null)}}if(!d.length){l=null}else if(!p){E=true;e.dragSession=p=P(e)}};s.onafterdragenter=function(e){if(!l||e.isMarked("NonDroppable")){d=[]}else if(e.getMark("DragWithin")!="SameControl"){d=d.filter(function(t){v=z(e,t,l,true);return t.fireDragEnter(e)})}var t=d[0];if(!t||t.getDropEffect()=="None"){O();v=""}else{$(e,t);v=z(e,t,l)}};s.onbeforedragover=function(e){var t=Date.now();if(t-m>=1e3){T(e,"longdragover");m=t}};s.onafterdragover=function(e){if(!l||e.isMarked("NonDroppable")){d=[]}else{d=d.filter(function(t){v=z(e,t,l,true);return t.fireDragOver(e)})}const t=d[0];if(!t||t.getDropEffect()=="None"){O();v=""}else{$(e,t);if(t&&t.getDropPosition(true)=="On"){return}v=z(e,t,l)}};s.onafterdragleave=function(e){if(E){if(r.browser.safari){C=setTimeout(R,100)}else if(!e.relatedTarget){R()}}};s.onbeforedrop=function(e){if(d.length){e.preventDefault()}};s.onafterdrop=function(e){d.forEach(function(t){t.fireDrop(e)});A=requestAnimationFrame(this.onafterdragend.bind(this,e))};s.onafterdragend=function(e){A=cancelAnimationFrame(A);c.forEach(function(t){t.fireDragEnd(e)});x(g,"sapUiDnDDragging");jQuery("html").removeClass("sapUiDnDNoScrolling");R()};i.addEventPreprocessor(s.preprocessEvent);i.addEventPostprocessor(s.postprocessEvent);return s},true);
//# sourceMappingURL=DragAndDrop.js.map