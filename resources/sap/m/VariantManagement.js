/*!
 * OpenUI5
 * (c) Copyright 2026 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/core/Lib","sap/ui/core/ShortcutHintsMixin","sap/ui/model/json/JSONModel","sap/ui/model/base/ManagedObjectModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/base/ManagedObjectObserver","sap/ui/Device","sap/ui/core/InvisibleText","sap/ui/core/Control","sap/ui/core/Icon","sap/ui/core/Item","sap/ui/layout/HorizontalLayout","sap/ui/layout/Grid","sap/m/SearchField","sap/m/RadioButton","sap/m/ColumnListItem","sap/m/Column","sap/m/Text","sap/m/Bar","sap/m/Table","sap/m/Page","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/Button","sap/m/CheckBox","sap/m/Dialog","sap/m/Input","sap/m/Label","sap/m/Title","sap/m/ResponsivePopover","sap/m/SelectList","sap/m/ObjectIdentifier","sap/m/OverflowToolbar","sap/m/OverflowToolbarLayoutData","sap/m/VBox","sap/m/HBox","sap/m/IllustratedMessage","sap/ui/events/KeyCodes","sap/base/Log","sap/ui/core/library","sap/m/library"],function(e,t,i,a,s,n,o,r,l,h,g,u,d,p,c,f,_,m,y,T,M,V,v,I,S,A,b,C,N,D,x,E,R,O,w,P,F,L,K,B,k,G,U){"use strict";var $=U.OverflowToolbarPriority;var H=U.ButtonType;var z=U.FlexAlignItems;var X=U.PlacementType;var j=U.PopinDisplay;var W=U.ScreenSize;var q=U.ListKeyboardMode;var Y=U.Sticky;var J=G.ValueState;var Q=G.TextAlign;var Z=G.TitleLevel;const ee=U.IllustratedMessageSize;var te=g.extend("sap.m.VariantManagement",{metadata:{interfaces:["sap.ui.core.IShrinkable","sap.m.IOverflowToolbarContent","sap.m.IToolbarInteractiveControl"],library:"sap.m",designtime:"sap/m/designtime/VariantManagement.designtime",properties:{supportDefault:{type:"boolean",group:"Misc",defaultValue:true},supportFavorites:{type:"boolean",group:"Misc",defaultValue:true},supportApplyAutomatically:{type:"boolean",group:"Misc",defaultValue:true},supportPublic:{type:"boolean",group:"Misc",defaultValue:true},supportContexts:{type:"boolean",group:"Misc",defaultValue:false},selectedKey:{type:"string",group:"Misc",defaultValue:""},defaultKey:{type:"string",group:"Misc",defaultValue:""},showSaveAs:{type:"boolean",group:"Misc",defaultValue:true},creationAllowed:{type:"boolean",group:"Misc",defaultValue:true},showFooter:{type:"boolean",group:"Misc",defaultValue:true},modified:{type:"boolean",group:"Misc",defaultValue:false},popoverTitle:{type:"string",group:"Misc",defaultValue:""},inErrorState:{type:"boolean",group:"Misc",defaultValue:false},level:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:Z.Auto},titleStyle:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:Z.Auto},maxWidth:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"100%"},_displayTextForExecuteOnSelectionForStandardVariant:{type:"string",group:"Misc",defaultValue:"",visibility:"hidden"},_showAsText:{type:"boolean",group:"Misc",defaultValue:false,visibility:"hidden"},_selectStategyForSameItem:{type:"boolean",group:"Misc",defaultValue:true,visibility:"hidden"},_standardKey:{type:"string",group:"Misc",defaultValue:"",visibility:"hidden"}},defaultAggregation:"items",aggregations:{items:{type:"sap.m.VariantItem",multiple:true,singularName:"item"}},events:{save:{parameters:{name:{type:"string"},overwrite:{type:"boolean"},key:{type:"string"},execute:{type:"boolean"},def:{type:"boolean"},public:{type:"boolean"},contexts:{type:"object[]"},tile:{type:"boolean"}}},cancel:{},manageCancel:{},manage:{parameters:{renamed:{type:"sap.m.VariantManagementRename[]"},deleted:{type:"string[]"},exe:{type:"sap.m.VariantManagementExe[]"},fav:{type:"sap.m.VariantManagementFav[]"},def:{type:"string"},contexts:{type:"object[]"}}},select:{parameters:{key:{type:"string"}}}}},renderer:{apiVersion:2,render:function(e,t){e.openStart("div",t).style("max-width",t.getMaxWidth()).class("sapMVarMngmt").openEnd();e.renderControl(t.oVariantLayout);e.close("div")}}});const ie=G.aria.HasPopup;te.INNER_MODEL_NAME="$sapMInnerVariants";te.MAX_NAME_LEN=100;te.COLUMN_FAV_IDX=0;te.COLUMN_NAME_IDX=1;te.COLUMN_DEFAULT_IDX=3;te.COLUMN_ROLES_IDX=5;te.prototype.init=function(){g.prototype.init.apply(this,arguments);this._oRb=t.getResourceBundleFor("sap.m");this.deviceIsMac=l.os.macintosh;this._oManagedObjectModel=new s(this);this.setModel(this._oManagedObjectModel,"$mVariants");this._oObserver=new r(this._observeChanges.bind(this));this._oObserver.observe(this,{aggregations:["items"]})};te.prototype._observeChanges=function(e){var t;if(e.type==="aggregation"){if(e.name==="items"){t=e.child;switch(e.mutation){case"insert":if(!this._oObserver.isObserved(t,{properties:["title","favorite","executeOnSelect","contexts"]})){this._oObserver.observe(t,{properties:["title","favorite","executeOnSelect","contexts"]})}if(this.getSelectedKey()===t.getKey()){this.refreshTitle()}break;case"remove":if(this._oObserver.isObserved(t,{properties:["title","favorite","executeOnSelect","contexts"]})){this._oObserver.unobserve(t,{properties:["title","favorite","executeOnSelect","contexts"]})}break;default:k.error("operation "+e.mutation+" not yet implemented")}}}else if(e.type==="property"){if(e.object?.isA?.("sap.m.VariantItem")){t=e.object;if(this.getSelectedKey()===t.getKey()){this.refreshTitle()}if(!this.oManagementTable||this.oManagementTable.getItems&&this.oManagementTable.getItems().length===0){if(e.name==="title"){t._setOriginalTitle(e.current)}else if(e.name==="favorite"){t._setOriginalFavorite(e.current)}else if(e.name==="executeOnSelect"){t._setOriginalExecuteOnSelect(e.current)}else if(e.name==="contexts"){t._setOriginalContexts(e.current)}}else{const i=this.oManagementTable.getItems().find(e=>{const i=this._findVariantItem(e.getBindingContext(this._sModelName));return i.getKey()===t.getKey()});if(e.name==="contexts"){this._updateContextsDependencies(i)}}}}};te.prototype.applySettings=function(e,t){g.prototype.applySettings.apply(this,arguments);this._createInnerModel();this._initializeControl()};te.prototype.getDisplayTextForExecuteOnSelectionForStandardVariant=function(){return this.getProperty("_displayTextForExecuteOnSelectionForStandardVariant")};te.prototype.setDisplayTextForExecuteOnSelectionForStandardVariant=function(e){this.setProperty("_displayTextForExecuteOnSelectionForStandardVariant",e);return this};te.prototype.setShowAsText=function(e){this.setProperty("_showAsText",e);this._reCreateVariantTextControl();return this};te.prototype.getShowAsText=function(){return this.getProperty("_showAsText")};te.prototype.setShowFooter=function(e){this.setProperty("showFooter",e);return this};te.prototype.setDefaultKey=function(e){this.setProperty("defaultKey",e);return this};te.prototype.setPopoverTitle=function(e){this.setProperty("popoverTitle",e);return this};te.prototype._createVariantTextControl=function(){var e=this.getShowAsText()?T:x;var t=new e(this.getId()+"-text",{text:{path:"/selectedKey",model:"$mVariants",formatter:function(e){var t="";if(e){t=this.getSelectedVariantText(e);this._setInvisibleText(t,this.getModified())}return t}.bind(this)}});if(t.isA("sap.m.Title")){t.bindProperty("level",{path:"/level",model:"$mVariants"});t.bindProperty("titleStyle",{path:"/titleStyle",model:"$mVariants"})}t.addStyleClass("sapMVarMngmtClickable");t.addStyleClass("sapMVarMngmtTitle");return t};te.prototype._initializeControl=function(){if(this.oVariantInvisibleText){return}this.oVariantInvisibleText=new h;this.oVariantText=this._createVariantTextControl();var e=new T(this.getId()+"-modified",{text:"*",visible:{path:"/modified",model:"$mVariants",formatter:function(e){var t=this.getSelectedKey();if(t){this._setInvisibleText(this.getSelectedVariantText(t),e)}return e===null||e===undefined?false:e}.bind(this)}});e.setVisible(false);e.addStyleClass("sapMVarMngmtModified");e.addStyleClass("sapMVarMngmtClickable");this.oVariantPopoverTrigger=new A(this.getId()+"-trigger",{icon:"sap-icon://slim-arrow-down",type:H.Transparent,tooltip:this._oRb.getText("VARIANT_MANAGEMENT_TRIGGER_TT"),enabled:{path:"/isDesignMode",model:te.INNER_MODEL_NAME,formatter:function(e){return!e}},ariaHasPopup:ie.Dialog});this.oVariantPopoverTrigger.addAriaLabelledBy(this.oVariantInvisibleText);this.oVariantPopoverTrigger.addStyleClass("sapMVarMngmtClickable");this.oVariantLayout=new p({content:[this.oVariantText,e,this.oVariantPopoverTrigger]});this.oVariantLayout.addStyleClass("sapMVarMngmtLayout");this.oVariantLayout.addStyleClass("sapMVarMngmtLayoutModifiedHidden");e.setVisible(false);this.oVariantModifiedText=e;this.oVariantInvisibleText.toStatic();this.addDependent(this.oVariantLayout)};te.prototype._reCreateVariantTextControl=function(){if(!this.getShowAsText()&&this.oVariantText&&this.oVariantText.isA("sap.m.Title)")){return}if(!this.getShowAsText()&&this.oVariantText&&this.oVariantText.isA("sap.m.Text)")){return}if(this.oVariantText){this.oVariantLayout.removeContent(0);this.oVariantText.destroy()}var e=this._createVariantTextControl();this.oVariantLayout.insertContent(e,0);this.oVariantText=e};te.prototype.getOverflowToolbarConfig=function(){return{canOverflow:false,invalidationEvents:["save","manage","select"]}};te.prototype.getTitle=function(){return this.oVariantText};te.prototype.refreshTitle=function(){if(this.oVariantText){this.oVariantText.getBinding("text").refresh(true)}};te.prototype._setInvisibleText=function(e,t){var i;if(e){if(t){i="VARIANT_MANAGEMENT_SEL_VARIANT_MOD";this.oVariantLayout.removeStyleClass("sapMVarMngmtLayoutModifiedHidden")}else{i="VARIANT_MANAGEMENT_SEL_VARIANT";this.oVariantLayout.addStyleClass("sapMVarMngmtLayoutModifiedHidden")}this.oVariantInvisibleText.setText(this._oRb.getText(i,[e]))}};te.prototype._createInnerModel=function(){var e=new a({showCreateTile:false,isDesignMode:false,hasNoData:false});this.setModel(e,te.INNER_MODEL_NAME)};te.prototype._getShowCreateTile=function(){return this._getInnerModelProperty("/showCreateTile")};te.prototype._setShowCreateTile=function(e){this._setInnerModelProperty("/showCreateTile",e)};te.prototype.getDesignMode=function(){return this._getInnerModelProperty("/isDesignMode")};te.prototype.setDesignMode=function(e){this._setInnerModelProperty("/isDesignMode",e)};te.prototype.setHasNoData=function(e){this._setInnerModelProperty("/hasNoData",e)};te.prototype._setInnerModelProperty=function(e,t){var i=this.getModel(te.INNER_MODEL_NAME);if(i){i.setProperty(e,t)}};te.prototype._getInnerModelProperty=function(e){var t=this.getModel(te.INNER_MODEL_NAME);if(t){return t.getProperty(e)}return null};te.prototype._getItems=function(){return this.getItems()};te.prototype.getSelectedVariantText=function(e){var t=this._getItemByKey(e);if(t){return t.getTitle()}return""};te.prototype.getStandardVariantKey=function(){var e=this.getProperty("_standardKey");if(!e){return this._getFirstVisibleVariant()}return e};te.prototype.setStandardVariantKey=function(e){this.setProperty("_standardKey",e)};te.prototype._getFirstVisibleVariant=function(){var e=this._getItems();for(var t=0;t<e.length;t++){if(!this._isItemDeleted(e[t])){if(this.getSupportFavorites()){if(e[t].getFavorite()){return e[t].getKey()}}else{return e[t].getKey()}}}return null};te.prototype._clearDeletedItems=function(){this._aDeletedItems=[]};te.prototype._addDeletedItem=function(e){var t=e.getKey();if(this._aDeletedItems.indexOf(t)<0){this._aDeletedItems.push(t)}};te.prototype._getDeletedItems=function(){return this._aDeletedItems};te.prototype._clearRenamedItems=function(){this._aRenamedItems=[]};te.prototype._addRenamedItem=function(e){var t=e.getKey();if(this._aRenamedItems.indexOf(t)<0){this._aRenamedItems.push(t)}};te.prototype._removeRenamedItem=function(e){var t=e.getKey();var i=this._aRenamedItems.indexOf(t);if(i>=0){this._aRenamedItems.splice(i,1)}};te.prototype._getRenamedItems=function(){return this._aRenamedItems};te.prototype.getItemByKey=function(e){return this._getItemByKey(e)};te.prototype._getItemByKey=function(e){var t=null;var i=this._getItems();if(i){i.some(function(i){if(i.getKey()===e){t=i}return t!==null})}return t};te.prototype._obtainControl=function(t){if(t&&t.target&&t.target.id){var i=t.target.id;var a=i.indexOf("-inner");if(a>0){i=i.substring(0,a)}return e.getElementById(i)}return null};te.prototype.handleOpenCloseVariantPopover=function(e){if(!this.bPopoverOpen){this._oCtrlRef=this._obtainControl(e);this._openVariantList()}else if(this.oVariantPopOver&&this.oVariantPopOver.isOpen()){this.oVariantPopOver.close()}else if(this.getInErrorState()&&this.oErrorVariantPopOver&&this.oErrorVariantPopOver.isOpen()){this.oErrorVariantPopOver.close()}};te.prototype.getFocusDomRef=function(){return this.oVariantPopoverTrigger.getFocusDomRef()};te.prototype.onclick=function(e){if(this.getDesignMode()){return}if(this.oVariantPopoverTrigger&&!this.bPopoverOpen){this.oVariantPopoverTrigger.focus()}this.handleOpenCloseVariantPopover(e)};te.prototype.onkeyup=function(e){if(e.keyCode===B.F4||e.keyCode===B.SPACE||e.altKey===true&&e.keyCode===B.ARROW_UP||e.altKey===true&&e.keyCode===B.ARROW_DOWN){this._oCtrlRef=this._obtainControl(e);this._openVariantList()}};te.prototype.onAfterRendering=function(){if(this.oVariantText){this.oVariantText.$().off("mouseover").on("mouseover",function(){this.oVariantPopoverTrigger.addStyleClass("sapMVarMngmtTriggerBtnHover")}.bind(this));this.oVariantText.$().off("mouseout").on("mouseout",function(){this.oVariantPopoverTrigger.removeStyleClass("sapMVarMngmtTriggerBtnHover")}.bind(this))}if(this.oVariantPopoverTrigger&&this.oVariantPopoverTrigger.$().length>0){this.oVariantPopoverTrigger.$().attr("aria-expanded","false")}};te.prototype._openInErrorState=function(){var e;if(!this.oErrorVariantPopOver){e=new F({fitContainer:true,alignItems:z.Center,items:[new u({size:"4rem",color:"lightgray",src:"sap-icon://message-error"}),new x({titleStyle:Z.H2,text:this._oRb.getText("VARIANT_MANAGEMENT_ERROR_TEXT1")}),new T({textAlign:Q.Center,text:this._oRb.getText("VARIANT_MANAGEMENT_ERROR_TEXT2")})]});e.addStyleClass("sapMVarMngmtErrorPopover");this.oErrorVariantPopOver=new E(this.getId()+"-errorpopover",{title:{path:"/popoverTitle",model:"$mVariants"},contentWidth:"400px",placement:X.VerticalPreferredBottom,content:[new v(this.getId()+"-errorselpage",{showSubHeader:false,showNavButton:false,showHeader:false,content:[e]})],afterOpen:function(){this.bPopoverOpen=true}.bind(this),afterClose:function(){if(this.bPopoverOpen){setTimeout(function(){this.bPopoverOpen=false}.bind(this),200)}}.bind(this),beforeClose:function(){this.oVariantPopoverTrigger?.$().attr("aria-expanded","false")}.bind(this),contentHeight:"300px"});this.oErrorVariantPopOver.attachBrowserEvent("keyup",function(e){if(e.which===32){this.oErrorVariantPopOver.close()}}.bind(this))}if(this.bPopoverOpen){return}this.oErrorVariantPopOver.openBy(this.oVariantLayout)};te.prototype._createIllustratedMessages=function(){if(!this._oNoDataIllustratedMessage||this._oNoDataIllustratedMessage.bIsDestroyed){this._oNoDataIllustratedMessage=new K({title:this._oRb.getText("VARIANT_MANAGEMENT_NODATA"),description:this._oRb.getText("VARIANT_MANAGEMENT_NODATA_DESCR"),enableVerticalResponsiveness:true,illustrationSize:ee.Auto,illustrationType:U.IllustratedMessageType.NoEntries})}if(!this._oNoDataFoundIllustratedMessage||this._oNoDataFoundIllustratedMessage.bIsDestroyed){this._oNoDataFoundIllustratedMessage=new K({title:this._oRb.getText("VARIANT_MANAGEMENT_NODATA_FOUND"),description:this._oRb.getText("VARIANT_MANAGEMENT_NODATA_FOUND_DESCR"),enableVerticalResponsiveness:true,illustrationSize:ee.Auto,illustrationType:U.IllustratedMessageType.NoSearchResults});this._oNoDataFoundIllustratedMessage.addStyleClass("sapMVarMngmtIllustratedMessage")}};te.prototype._createVariantList=function(){if(this.oVariantPopOver){return}this._createIllustratedMessages();this.oVariantManageBtn=new A(this.getId()+"-manage",{text:this._oRb.getText("VARIANT_MANAGEMENT_MANAGE"),enabled:true,press:function(){this._openManagementDialog()}.bind(this),layoutData:new P({priority:$.Low})});this.oVariantSaveBtn=new A(this.getId()+"-mainsave",{text:this._oRb.getText("VARIANT_MANAGEMENT_SAVE"),press:function(){this._handleVariantSave()}.bind(this),visible:{parts:[{path:"$mVariants>/creationAllowed"},{path:"$mVariants>/modified"},{path:"$mVariants>/selectedKey"}],formatter:function(e,t,i){var a=false;var s=this._getItemByKey(i);if(s){a=s.getChangeable()}return e&&t&&a}.bind(this)},type:H.Emphasized,layoutData:new P({priority:$.Low})});i.addConfig(this.oVariantSaveBtn,{addAccessibilityLabel:true,message:this._getSaveTooltipText("SAVE_MAIN")},this);this.oVariantSaveAsBtn=new A(this.getId()+"-saveas",{text:this._oRb.getText("VARIANT_MANAGEMENT_SAVEAS"),press:function(){this._openSaveAsDialog()}.bind(this),layoutData:new P({priority:$.Low}),visible:{parts:[{path:"$mVariants>/creationAllowed"},{path:"$mVariants>/showSaveAs"}],formatter:function(e,t){return e&&t}}});this.oVariantList=new R(this.getId()+"-list",{selectedKey:{path:"/selectedKey",model:"$mVariants"},visible:{path:"/hasNoData",model:te.INNER_MODEL_NAME,formatter:function(e){return!e}},itemPress:function(e){var t=null;if(e&&e.getParameters()){var i=e.getParameters().item;if(i){t=i.getKey()}}if(t){this.setCurrentVariantKey(t);this.oVariantPopOver.close()}}.bind(this)});this.oVariantListInvisibleText=new h({text:this._oRb.getText("VARIANT_MANAGEMENT_VIEW_LIST")});this.oVariantListInvisibleText.toStatic();this.oVariantList.addAriaLabelledBy(this.oVariantListInvisibleText);this.oNodataTextLayout=new F(this.getId()+"-no-data",{visible:{path:"/hasNoData",model:te.INNER_MODEL_NAME},fitContainer:true,items:[this._oNoDataFoundIllustratedMessage]});var e=new d({key:"{$mVariants>key}",text:"{$mVariants>title}"});this.oVariantList.bindAggregation("items",{path:"/items",model:"$mVariants",template:e});this._oSearchField=new f(this.getId()+"-search");this._oSearchField.attachLiveChange(function(e){this._triggerSearch(e,this.oVariantList)}.bind(this));this.oVariantSelectionPage=new v(this.getId()+"-selpage",{subHeader:new I({content:[this._oSearchField]}),content:[this.oVariantList,this.oNodataTextLayout],footer:new w({content:[new S(this.getId()+"-spacer"),this.oVariantSaveBtn,this.oVariantSaveAsBtn,this.oVariantManageBtn]}),showNavButton:false,showHeader:false});this.oVariantSelectionPage.bindProperty("showFooter",{path:"/showFooter",model:"$mVariants"});this.oVariantPopOver=new E(this.getId()+"-popover",{title:{path:"/popoverTitle",model:"$mVariants"},titleAlignment:"Auto",contentWidth:"400px",placement:X.VerticalPreferredBottom,resizable:true,content:[this.oVariantSelectionPage],afterOpen:function(){this.bPopoverOpen=true}.bind(this),afterClose:function(){if(this.bPopoverOpen){setTimeout(function(){this.bPopoverOpen=false}.bind(this),200)}}.bind(this),beforeClose:function(){this.oVariantPopoverTrigger?.$().attr("aria-expanded","false")}.bind(this),contentHeight:"300px"});this.oVariantPopOver.addEventDelegate({onkeydown:function(e){const t=this.deviceIsMac?e.metaKey:e.ctrlKey;if(e.keyCode==B.S&&e.shiftKey===false&&e.altKey===false&&t===true){if(this.oVariantSaveBtn?.getVisible()&&this.oVariantSaveBtn?.getEnabled()){e.preventDefault();e.stopPropagation();this._handleVariantSave()}}}},this);this.oVariantPopOver.addStyleClass("sapMVarMngmtPopover");if(this.oVariantLayout.$().closest(".sapUiSizeCompact").length>0){this.oVariantPopOver.addStyleClass("sapUiSizeCompact")}this.addDependent(this.oVariantPopOver);this.oVariantPopOver.isPopupAdaptationAllowed=function(){return false}};te.prototype.setCurrentVariantKey=function(e){var t=this.getItemByKey(e);if(t){var i=this.getProperty("_selectStategyForSameItem");if(i||!i&&this.getSelectedKey()!==e){this.setSelectedKey(e);this.fireSelect({key:e})}}else{k.error("setCurrentVariantKey called with unknown key:'"+e+"'")}};te.prototype._determineEmphasizedFooterButton=function(){if(this.oVariantSaveBtn.getVisible()){this.oVariantSaveBtn.setType(H.Emphasized);this.oVariantSaveAsBtn.setType(H.Default)}else{this.oVariantSaveAsBtn.setType(H.Emphasized)}};te.prototype.setModified=function(e){this.setProperty("modified",e);return this};te.prototype._openVariantList=function(){if(this.getInErrorState()){this._openInErrorState();return}this.oVariantPopoverTrigger.$().attr("aria-expanded","true");if(this.bPopoverOpen||this.iOpenTimer){return}this._createVariantList();this._oSearchField.setValue("");const e=this.oVariantList.getBinding("items");e.attachChange(function(e){this.setHasNoData(this.oVariantList.getItems().length===0)}.bind(this));e.filter(this._getFilters());if(this.oVariantList.getItems().length<1){this.oNodataTextLayout.removeAllItems();this.oNodataTextLayout.addItem(this._oNoDataIllustratedMessage)}this.oVariantSelectionPage.setShowSubHeader(this.oVariantList.getItems().length>9);this._determineEmphasizedFooterButton();var t=this.oVariantList.getSelectedItem();if(t){this.oVariantPopOver.setInitialFocus(t.getId())}var i=this._oCtrlRef?this._oCtrlRef:this.oVariantLayout;this._oCtrlRef=null;this.iOpenTimer=setTimeout(()=>{delete this.iOpenTimer;if(!this.isDestroyed()){this.oVariantPopOver.openBy(i)}},100)};te.prototype._triggerSearch=function(e,t){if(!e){return}var i=e.getParameters();if(!i){return}var a=i.newValue?i.newValue:"";var s=new n({path:"title",operator:o.Contains,value1:a});t.getBinding("items").filter(this._getFilters(s));if(t.getItems().length<1){if(this.oNodataTextLayout.getItems().length===0||this.oNodataTextLayout.getItems().length>0&&this.oNodataTextLayout.getItems()[0]!==this._oNoDataFoundIllustratedMessage){if(!this._oNoDataFoundIllustratedMessage.hasStyleClass("sapMVarMngmtIllustratedMessage")){this._oNoDataFoundIllustratedMessage.toggleStyleClass("sapMVarMngmtIllustratedMessage")}this.oNodataTextLayout.removeAllItems();this.oNodataTextLayout.addItem(this._oNoDataFoundIllustratedMessage)}}};te.prototype._createSaveAsDialog=function(){if(!this.oSaveAsDialog){this.oInputName=new N(this.getId()+"-name",{liveChange:function(){this._checkVariantNameConstraints(this.oInputName)}.bind(this)});var e=new D(this.getId()+"-namelabel",{text:this._oRb.getText("VARIANT_MANAGEMENT_NAME")});e.setLabelFor(this.oInputName);e.addStyleClass("sapMVarMngmtSaveDialogLabel");this.oDefault=new b(this.getId()+"-default",{text:this._oRb.getText("VARIANT_MANAGEMENT_SETASDEFAULT"),visible:{path:"/supportDefault",model:"$mVariants"},select:function(e){if(this._sStyleClass){if(e.getParameter("selected")){var t=this._getContextInfoChanges();if(this._isRestricted(t)){this.oDefault.setValueState(J.Error);this.oDefault.setValueStateText(this._oRb.getText("VARIANT_MANAGEMENT_NO_DEFAULT_ON_RESTRICTED_VIEWS"));this.oDefault.focus()}else{this.oDefault.setValueState(J.None);this.oDefault.setValueStateText("")}}else if(this.oDefault.getValueState()!=J.None){this.oDefault.setValueState(J.None);this.oDefault.setValueStateText("")}}}.bind(this),width:"100%"});this.oPublic=new b(this.getId()+"-public",{text:this._oRb.getText("VARIANT_MANAGEMENT_SETASPUBLIC"),visible:{path:"/supportPublic",model:"$mVariants"},width:"100%"});this.oExecuteOnSelect=new b(this.getId()+"-execute",{text:this._oRb.getText("VARIANT_MANAGEMENT_EXECUTEONSELECT"),visible:{path:"/supportApplyAutomatically",model:"$mVariants"},width:"100%"});this.oCreateTile=new b(this.getId()+"-tile",{text:this._oRb.getText("VARIANT_MANAGEMENT_CREATETILE"),enabled:true,visible:{path:"/showCreateTile",model:te.INNER_MODEL_NAME},width:"100%"});this.oSaveSave=new A(this.getId()+"-variantsave",{text:this._oRb.getText("VARIANT_MANAGEMENT_SAVE"),type:H.Emphasized,press:this._fireVariantSaveAsEvent.bind(this),enabled:true});this.oSaveAsCancel=new A(this.getId()+"-variantcancel",{text:this._oRb.getText("VARIANT_MANAGEMENT_CANCEL"),press:this._cancelPressed.bind(this)});i.addConfig(this.oSaveSave,{addAccessibilityLabel:true,message:this._getSaveTooltipText("SAVE")},this);var t=new c({defaultSpan:"L12 M12 S12"});t.addContent(this.oDefault);t.addContent(this.oPublic);t.addContent(this.oExecuteOnSelect);t.addContent(this.oCreateTile);this.oSaveAsDialog=new C(this.getId()+"-savedialog",{title:this._oRb.getText("VARIANT_MANAGEMENT_SAVEDIALOG"),afterClose:function(){this._bSaveOngoing=false;if(this._sStyleClass){this.setSupportPublic(this._bShowPublic);this.oSaveAsDialog.removeStyleClass(this._sStyleClass);if(this._oRolesComponentContainer){this.oSaveAsDialog.removeContent(this._oRolesComponentContainer)}this._sStyleClass=undefined;this._oRolesComponentContainer=null}}.bind(this),beginButton:this.oSaveSave,endButton:this.oSaveAsCancel,content:[e,this.oInputName,t],stretch:l.system.phone});this.oSaveAsDialog.isPopupAdaptationAllowed=function(){return false};this.oSaveAsDialog.addStyleClass("sapUiContentPadding");this.oSaveAsDialog.addStyleClass("sapMVarMngmtSaveDialog");if(this.oVariantLayout.$().closest(".sapUiSizeCompact").length>0){this.oSaveAsDialog.addStyleClass("sapUiSizeCompact")}this.addDependent(this.oSaveAsDialog);this.oInputName.attachSubmit(this._fireVariantSaveAsEvent,this)}};te.prototype._fireVariantSaveAsEvent=function(){if(!this._bSaveOngoing){this._checkVariantNameConstraints(this.oInputName);if(this.oInputName.getValueState()===J.Error){this.oInputName.focus();return}this._bSaveOngoing=true;this._bSaveCanceled=false;const e=this._handleVariantSaveAs(this.oInputName.getValue());if(!e){this._bSaveOngoing=false}}};te.prototype._cancelPressed=function(){this._bSaveCanceled=true;this.fireCancel();this.oSaveAsDialog.close()};te.prototype._getSelectedContexts=function(){return this._oRolesComponentContainer.getComponentInstance().getSelectedContexts()};te.prototype._setSelectedContexts=function(e){if(!e||Object.keys(e).length===0){e={role:[]}}this._oRolesComponentContainer.getComponentInstance().setSelectedContexts(e)};te.prototype._isInErrorContexts=function(){return this._oRolesComponentContainer.getComponentInstance().hasErrorsAndShowErrorMessage()};te.prototype._isRestricted=function(e){if(!e){e={role:[]}}return e.role&&e.role.length>0};te.prototype._determineRolesSpecificText=function(e,t){if(t){t.setText(this._oRb.getText(this._isRestricted(e.getContexts())?"VARIANT_MANAGEMENT_VISIBILITY_RESTRICTED":"VARIANT_MANAGEMENT_VISIBILITY_NON_RESTRICTED"))}};te.prototype._checkAndAddRolesContainerToManageDialog=function(){if(this._oRolesComponentContainer&&this._oRolesDialog){var e=null;this._oRolesDialog.getContent().some(function(t){if(t===this._oRolesComponentContainer){e=t;return true}return false}.bind(this));if(!e){this._oRolesDialog.addContent(this._oRolesComponentContainer)}}};te.prototype._createRolesDialog=function(){if(!this._oRolesDialog){this._oRolesDialog=new C(this.getId()+"-roledialog",{draggable:true,resizable:true,contentWidth:"40%",title:this._oRb.getText("VARIANT_MANAGEMENT_SELECTROLES_DIALOG"),beginButton:new A(this.getId()+"-rolesave",{text:this._oRb.getText("VARIANT_MANAGEMENT_SAVE"),type:H.Emphasized,press:function(){if(!this._checkAndCreateContextInfoChanges(this._oCurrentContextsKey,this._oTextControl)){return}this._oRolesDialog.close()}.bind(this)}),endButton:new A(this.getId()+"-rolecancel",{text:this._oRb.getText("VARIANT_MANAGEMENT_CANCEL"),press:function(){this._oRolesDialog.close()}.bind(this)}),content:[this._oRolesComponentContainer],stretch:l.system.phone});this._oRolesDialog.setParent(this);this._oRolesDialog.addStyleClass("sapUiContentPadding");this._oRolesDialog.addStyleClass(this._sStyleClass);this._oRolesDialog.isPopupAdaptationAllowed=function(){return false}}this._checkAndAddRolesContainerToManageDialog()};te.prototype._openRolesDialog=function(e,t){this._createRolesDialog();this._oCurrentContextsKey=e.getKey();this._oTextControl=t;this._setSelectedContexts(e.getContexts());this._oRolesDialog.open()};te.prototype._checkAndCreateContextInfoChanges=function(e,t){if(e){if(this._oRolesComponentContainer){try{if(!this._isInErrorContexts()){var i=this._getSelectedContexts();var a=this._getItemByKey(e);if(a){a.setContexts(i);this._determineRolesSpecificText(a,t);this._checkDefaultEnabled(a)}}else{return false}}catch(e){return false}}return true}return false};te.prototype._checkAndAddRolesContainerToSaveAsDialog=function(){if(this._oRolesComponentContainer&&this.oSaveAsDialog){var e=null;this.oSaveAsDialog.getContent().some(function(t){if(t===this._oRolesComponentContainer){e=t;return true}return false}.bind(this));this._setSelectedContexts({role:[]});if(!e){this.oSaveAsDialog.addContent(this._oRolesComponentContainer)}}};te.prototype.openSaveAsDialog=function(e,t){this._openSaveAsDialog(true);this.oSaveAsDialog.addStyleClass(e);this._sStyleClass=e;this._bShowPublic=this.getSupportPublic();this.setSupportPublic(false);if(t){Promise.all([t]).then(function(e){this._oRolesComponentContainer=e[0];this.setSupportContexts(!!this._oRolesComponentContainer);this._checkAndAddRolesContainerToSaveAsDialog();this.oSaveAsDialog.open()}.bind(this))}else{this.oSaveAsDialog.open()}};te.prototype._openSaveAsDialog=function(e){this._createSaveAsDialog();this.setSupportContexts(false);this.oInputName.setValue(this.getSelectedVariantText(this.getSelectedKey()));this.oInputName.setEnabled(true);this.oInputName.setValueState(J.None);this.oInputName.setValueStateText(null);this.oDefault.setEnabled(true);this.oDefault.setSelected(false);if(this.oDefault.getValueState()!==J.None){this.oDefault.setValueState(J.None);this.oDefault.setValueStateText("")}this.oPublic.setSelected(false);this.oExecuteOnSelect.setSelected(false);this.oCreateTile.setSelected(false);if(this.oVariantPopOver){this.oVariantPopOver.close()}if(!e){this.oSaveAsDialog.open()}this.oInputName.selectText(0,this.getSelectedVariantText(this.getSelectedKey()).length)};te.prototype._handleVariantSaveAs=function(e){var t=null;var i=e.trim();if(i===""){this.oInputName.setValueState(J.Error);this.oInputName.setValueStateText(this._oRb.getText("VARIANT_MANAGEMENT_ERROR_EMPTY"));return false}var a=this._getContextInfoChanges();var s=this._isRestricted(a);if(s&&this.oDefault.getSelected()){this.oDefault.setValueState(J.Error);this.oDefault.setValueStateText(this._oRb.getText("VARIANT_MANAGEMENT_NO_DEFAULT_ON_RESTRICTED_VIEWS"));this.oDefault.focus();return false}else if(!s){var n=this.oDefault.getValueState()!==J.None;this.oDefault.setValueState(J.None);this.oDefault.setValueStateText("");if(n){return false}}if(this.oSaveAsDialog){this.oSaveAsDialog.close()}var o={key:t,name:i,overwrite:false,def:this.oDefault.getSelected(),execute:this.oExecuteOnSelect.getSelected(),public:this.getSupportPublic()?this.oPublic.getSelected():undefined,contexts:a};if(this._getShowCreateTile()&&this.oCreateTile){o.tile=this.oCreateTile.getSelected()}this.destroyManageDialog();this.fireSave(o);return true};te.prototype._getContextInfoChanges=function(){if(this._oRolesComponentContainer){try{if(!this._isInErrorContexts()){return this._getSelectedContexts()}}catch(e){return undefined}}return undefined};te.prototype._handleVariantSave=function(){var e=this._getItemByKey(this.getSelectedKey());var t=false;if(this.getDefaultKey()===e.getKey()){t=true}if(this.oVariantPopOver){this.oVariantPopOver.close()}this.fireSave({name:e.getTitle(),overwrite:true,key:e.getKey(),def:t})};te.prototype.destroyManageDialog=function(){if(this.oManagementDialog){this.oManagementDialog.destroy();this.oManagementDialog=undefined}};te.prototype.openManagementDialog=function(e,t,i){if(e&&this.oManagementDialog){this.oManagementDialog.destroy();this.oManagementDialog=undefined}if(t){this._sStyleClass=t;this._bShowPublic=this.getSupportPublic();this.setSupportPublic(false);this.setSupportContexts(false)}if(i){Promise.all([i]).then(function(e){this._oRolesComponentContainer=e[0];this.setSupportContexts(!!this._oRolesComponentContainer);this._openManagementDialog();if(this._sStyleClass){this.oManagementDialog.addStyleClass(this._sStyleClass)}}.bind(this))}else{this._openManagementDialog();if(this._sStyleClass){this.oManagementDialog.addStyleClass(this._sStyleClass)}}};te.prototype._triggerSearchInManageDialog=function(e,t){if(!e){return}var i=e.getParameters();if(!i){return}var a;if(i.query){a=i.query}else{a=i.newValue?i.newValue:""}this._triggerSearchInManageDialogByValue(a,t)};te.prototype._triggerSearchInManageDialogByValue=function(e,t){var i=[this._getVisibleFilter(),new n({filters:[new n({path:"title",operator:o.Contains,value1:e}),new n({path:"author",operator:o.Contains,value1:e})],and:false})];t.getBinding("items").filter(i);if(this.oManagementTable.getItems().length<1){if(this._oNoDataFoundIllustratedMessage.hasStyleClass("sapMVarMngmtIllustratedMessage")){this._oNoDataFoundIllustratedMessage.toggleStyleClass("sapMVarMngmtIllustratedMessage")}this.oManagementTable.setNoData(this._oNoDataFoundIllustratedMessage)}this._bRebindRequired=true};te.prototype.getManageDialog=function(){return this.oManagementDialog};te.prototype._createManagementDialog=function(){if(!this.oManagementDialog||this.oManagementDialog.bIsDestroyed){this._createIllustratedMessages();this.oManagementTable=new V(this.getId()+"-managementTable",{contextualWidth:"Auto",fixedLayout:false,growing:true,noData:this._oNoDataIllustratedMessage,keyboardMode:q.Navigation,sticky:[Y.ColumnHeaders],columns:[new y({header:new h({text:this._oRb.getText("VARIANT_MANAGEMENT_FAVORITE_COLUMN")}),width:"3rem",visible:{path:"/supportFavorites",model:"$mVariants"}}),new y({header:new T({text:this._oRb.getText("VARIANT_MANAGEMENT_NAME")}),width:"16rem"}),new y({header:new T({text:this._oRb.getText("VARIANT_MANAGEMENT_VARIANTTYPE"),wrappingType:"Hyphenated"}),visible:{path:"/supportPublic",model:"$mVariants"},demandPopin:true,popinDisplay:j.Inline,minScreenWidth:W.Tablet}),new y({header:new T({text:this._oRb.getText("VARIANT_MANAGEMENT_DEFAULT"),wrappingType:"Hyphenated"}),hAlign:Q.Center,demandPopin:true,popinDisplay:j.Block,minScreenWidth:W.Tablet,visible:{path:"/supportDefault",model:"$mVariants"}}),new y({header:new T({text:this._oRb.getText("VARIANT_MANAGEMENT_EXECUTEONSELECT"),wrappingType:"Hyphenated"}),hAlign:this.getDisplayTextForExecuteOnSelectionForStandardVariant()?Q.Begin:Q.Center,demandPopin:true,popinDisplay:j.Block,minScreenWidth:W.Tablet,visible:{path:"/supportApplyAutomatically",model:"$mVariants"}}),new y({header:new T({text:this._oRb.getText("VARIANT_MANAGEMENT_VISIBILITY"),wrappingType:"Hyphenated"}),width:"8rem",demandPopin:true,popinDisplay:j.Inline,minScreenWidth:W.Tablet,visible:{path:"/supportContexts",model:"$mVariants"}}),new y({header:new T({text:this._oRb.getText("VARIANT_MANAGEMENT_AUTHOR"),wrappingType:"Hyphenated"}),demandPopin:true,popinDisplay:j.Block,minScreenWidth:W.Tablet}),new y({header:new h({text:this._oRb.getText("VARIANT_MANAGEMENT_ACTION_COLUMN")}),hAlign:Q.Center}),new y({visible:false})]});this.oManagementSave=new A(this.getId()+"-managementsave",{text:this._oRb.getText("VARIANT_MANAGEMENT_SAVE"),enabled:true,type:H.Emphasized,press:function(){if(this._handleManageSavePressed()&&this.oManagementDialog){this.oManagementDialog.close()}}.bind(this)});i.addConfig(this.oManagementSave,{addAccessibilityLabel:true,message:this._getSaveTooltipText("SAVE")},this);this.oManagementCancel=new A(this.getId()+"-managementcancel",{text:this._oRb.getText("VARIANT_MANAGEMENT_CANCEL"),press:function(){this._resumeManagementTableBinding();this._handleManageCancelPressed();if(this.oManagementDialog){this.oManagementDialog.close()}}.bind(this)});this.oManagementDialog=new C(this.getId()+"-managementdialog",{contentWidth:"64%",resizable:true,draggable:true,title:this._oRb.getText("VARIANT_MANAGEMENT_MANAGEDIALOG"),beginButton:this.oManagementSave,endButton:this.oManagementCancel,afterClose:function(){if(this._sStyleClass){this.setSupportPublic(this._bShowPublic,true);this.oManagementDialog.removeStyleClass(this._sStyleClass);this._sStyleClass=undefined;this._oRolesComponentContainer=null}}.bind(this),content:[this.oManagementTable],stretch:l.system.phone});this.oManagementDialog.isPopupAdaptationAllowed=function(){return false};this._oSearchFieldOnMgmtDialog=new f;this._oSearchFieldOnMgmtDialog.attachLiveChange(function(e){this._triggerSearchInManageDialog(e,this.oManagementTable)}.bind(this));this._oSearchFieldOnMgmtDialog.attachSearch(function(e){this._triggerSearchInManageDialog(e,this.oManagementTable)}.bind(this));var e=new M(this.getId()+"-mgmHeaderSearch",{contentMiddle:[this._oSearchFieldOnMgmtDialog]});this.oManagementDialog.setSubHeader(e);this.oManagementDialog.setInitialFocus(this._oSearchFieldOnMgmtDialog);if(this.oVariantLayout.$().closest(".sapUiSizeCompact").length>0){this.oManagementDialog.addStyleClass("sapUiSizeCompact")}this._oSearchFieldOnMgmtDialog.addEventDelegate({onkeydown:e=>{if(e.keyCode===B.ENTER){this._handleManagementDialogKeydown(e)}}},this);this.addDependent(this.oManagementDialog);this._rebindVMTable(true)}};te.prototype._getSaveTooltipText=function(e){const t=`VARIANT_MANAGEMENT_${e}_TT${this.deviceIsMac?"_MAC":""}`;return this._oRb.getText(t)};te.prototype._handleManagementDialogKeydown=function(e){var t=this.deviceIsMac?e.metaKey:e.ctrlKey;if(e.shiftKey===false&&e.altKey===false&&t===true){this.oManagementSave.firePress();e.stopPropagation();e.preventDefault()}};te.prototype._setFavoriteIcon=function(e,t){if(e){e.setSrc(t?"sap-icon://favorite":"sap-icon://unfavorite");e.setTooltip(this._oRb.getText(t?"VARIANT_MANAGEMENT_FAV_DEL_TOOLTIP":"VARIANT_MANAGEMENT_FAV_ADD_TOOLTIP"));e.setAlt(this._oRb.getText(t?"VARIANT_MANAGEMENT_FAV_DEL_ACC":"VARIANT_MANAGEMENT_FAV_ADD_ACC"))}};te.prototype._checkDefaultEnabled=function(e){var t=true;if(this._isRestricted(e.getContexts())){t=false;if(e.getKey()===this.getDefaultKey()){this.setDefaultKey(this.getStandardVariantKey())}}var i=this._getRowForKey(e.getKey());if(i){i.getCells()[te.COLUMN_DEFAULT_IDX].setEnabled(t);this._toggleIconActivityState(i.getCells()[0],e,false)}};te.prototype._templateFactoryManagementDialog=function(e,t){const i=null;let a;let s;const n=this._findVariantItem(t);if(!n){k.error("couldn't obtain the item for '"+t.getPath()+"'");return undefined}var o=this._determineIndex(t.getPath());if(o<0){k.error("couldn't obtain item position for '"+t.getPath()+"'");return undefined}const r=this.getId()+"-manage";const l=this._sModelName;const h=function(e){const t=e.oSource.getBindingContext(l);const i=this._findVariantItem(t);this._handleManageTitleChange(e.oSource,i)}.bind(this);const g=function(e){const t=e.oSource.getBindingContext(l);const i=this._findVariantItem(t);i.setTitle(e.oSource.getValue());this._handleManageTitleChange(e.oSource,i)}.bind(this);const d=function(e){const t=e.oSource.getBindingContext(l);const i=this._findVariantItem(t);this._handleManageDefaultVariantChange(e.oSource,i,e.getParameters().selected)}.bind(this);const p=function(e){const t=e.oSource.getBindingContext(l);const i=this._findVariantItem(t);this._handleManageDeletePressed(i);this._reCheckVariantNameConstraints()}.bind(this);const c=function(e){const t=e.oSource.getBindingContext(l);const i=this._findVariantItem(t);this._handleManageFavoriteChanged(e.oSource,i)}.bind(this);const f=e=>{const t=e.oSource.getBindingContext(l);const i=this._findVariantItem(t);i.setExecuteOnSelect(e.getParameter("selected"))};if(n.getRename()){a=new N(r+"-input-"+o,{liveChange:h,change:g,value:"{"+l+">title}"});if(n.getTitle()!==n._getOriginalTitle()){this._verifyVariantNameConstraints(a,n.getKey(),n.getTitle())}}else{a=new O(r+"-text-"+o,{title:"{"+l+">title}"});if(i){a.setTooltip(i)}}const y=new A(r+"-del-"+o,{icon:"sap-icon://decline",enabled:true,type:H.Transparent,press:p,tooltip:this._oRb.getText("VARIANT_MANAGEMENT_DELETE"),visible:n.getRemove()});const M=new u(r+"-fav-"+o,{src:{path:"favorite",model:l,formatter:function(e){return e?"sap-icon://favorite":"sap-icon://unfavorite"}},tooltip:{path:"favorite",model:l,formatter:function(e){return this._oRb.getText(e?"VARIANT_MANAGEMENT_FAV_DEL_TOOLTIP":"VARIANT_MANAGEMENT_FAV_ADD_TOOLTIP")}.bind(this)},press:c,decorative:false});if(this.getStandardVariantKey()===n.getKey()||this.getDefaultKey()===n.getKey()){this._setIconStyleClass(M,"sapMVarMngmtFavNonInteractiveColor")}else{this._setIconStyleClass(M,"sapMVarMngmtFavColor")}if(this.getDisplayTextForExecuteOnSelectionForStandardVariant()&&this.getStandardVariantKey()===n.getKey()){s=new b(r+"-exe-"+o,{wrapping:true,text:"{$mVariants>/_displayTextForExecuteOnSelectionForStandardVariant}",selected:"{"+l+">executeOnSelect}",select:f})}else{s=new b(r+"-exe-"+o,{text:"",selected:"{"+l+">executeOnSelect}",select:f})}const V=this._createRolesCell(n,t);const v=new _(r+"-def-"+o,{groupName:this.getId(),select:d,selected:{path:"/defaultKey",model:"$mVariants",formatter:function(e){return n.getKey()===e}}});if(V.isA("sap.m.HBox")&&this._isRestricted(n.getContexts())){v.setEnabled(false);if(this.getDefaultKey()===n.getKey()){this.setDefaultKey(this.getStandardVariantKey())}}const I=new m({cells:[M,a,new T(r+"-type-"+o,{text:{path:"sharing",model:l,formatter:function(e){return this._oRb.getText(e==="Private"?"VARIANT_MANAGEMENT_PRIVATE":"VARIANT_MANAGEMENT_PUBLIC")}.bind(this)},textAlign:"Center"}),v,s,V,new T(r+"-author-"+o,{text:"{"+l+">author}",textAlign:"Begin",wrappingType:"Hyphenated"}),y,new T({text:"{"+l+">key}"})]});if(this._isItemDeleted(n)){I.setVisible(false)}return I};te.prototype._openManagementDialog=function(){this._clearDeletedItems();this._clearRenamedItems();this._createManagementDialog();if(this.oVariantPopOver){this.oVariantPopOver.close()}this._suspendManagementTableBinding();this._sDefaultKey=this.getDefaultKey();this._sOriginalDefaultKey=this._sDefaultKey;this._oSearchFieldOnMgmtDialog.setValue("");if(this._bRebindRequired){this._rebindVMTable()}if(this.oManagementTable.getItems().length<1){this.oManagementTable.setNoData(this._oNoDataIllustratedMessage)}this.oManagementDialog.open()};te.prototype._toggleIconActivityState=function(e,t,i){if(!e){return}if(!t||t.getKey()===this.getStandardVariantKey()){return}if(i&&e.hasStyleClass("sapMVarMngmtFavColor")){e.removeStyleClass("sapMVarMngmtFavColor");this._setIconStyleClass(e,"sapMVarMngmtFavNonInteractiveColor")}else if(e.hasStyleClass("sapMVarMngmtFavNonInteractiveColor")){e.removeStyleClass("sapMVarMngmtFavNonInteractiveColor");this._setIconStyleClass(e,"sapMVarMngmtFavColor")}};te.prototype._setIconStyleClass=function(e,t){if(e){e.addStyleClass(t);e.setNoTabStop(t==="sapMVarMngmtFavNonInteractiveColor")}};te.prototype._handleManageTitleChange=function(e,t){this._checkVariantNameConstraints(e,t.getKey());this._addRenamedItem(t)};te.prototype._handleManageDefaultVariantChange=function(e,t,i){var a=t.getKey();if(e){var s=e.getParent().getCells()[te.COLUMN_FAV_IDX];if(i){if(this.getSupportFavorites()&&!t.getFavorite()){t.setFavorite(true);var n=this._getRowForKey(t.getKey());if(n){var o=n.getCells();if(o){s=o[te.COLUMN_FAV_IDX];this._setFavoriteIcon(s,true);o[te.COLUMN_FAV_IDX+3].focus()}}}this.setDefaultKey(a)}this._toggleIconActivityState(s,t,i)}};te.prototype._handleManageCancelPressed=function(){if(this._getDeletedItems().length>0){this._getDeletedItems().forEach(function(e){var t=this._getRowForKey(e);if(t&&!t.getVisible()){t.setVisible(true)}}.bind(this));this._clearDeletedItems()}this._resetToOriginal();if(this._sOriginalDefaultKey!==this.getDefaultKey()){var e=this.getDefaultKey();this.setDefaultKey(this._sOriginalDefaultKey);if(e!==this.getStandardVariantKey()){var t=this._getRowForKey(e);if(t){var i=t.getCells()[te.COLUMN_FAV_IDX];this._toggleIconActivityState(i,this._getItemByKey(e),false)}}}this._clearRenamedItems();this._bRebindRequired=true;if(this._oManagedObjectModel){this._oManagedObjectModel.checkUpdate()}this.fireManageCancel()};te.prototype._handleManageFavoriteChanged=function(e,t){if(this.getStandardVariantKey()===t.getKey()){return}if(this.getDefaultKey()===t.getKey()&&t.getFavorite()){return}t.setFavorite(!t.getFavorite());var i=this._getRowForKey(t.getKey());if(i){const e=i.getCells()[te.COLUMN_FAV_IDX];this._setFavoriteIcon(e,t.getFavorite());e.focus()}};te.prototype._handleManageDeletePressed=function(e){var t=e.getKey();if(!e.getRemove()){return}const i=this._findNextFocusTargetAfterDelete(e);this._addDeletedItem(e);if(t===this.getDefaultKey()){this.setDefaultKey(this.getStandardVariantKey());if(this.getSupportFavorites()){var a=this._getItemByKey(this.getStandardVariantKey());if(a&&!a.getFavorite()){var s=this._getRowForKey(this.getStandardVariantKey());if(s){a.setFavorite(true);this._setFavoriteIcon(s.getCells()[te.COLUMN_FAV_IDX],true)}}}}var n=this._getRowForKey(e.getKey());if(n){n.setVisible(false)}if(i){i.focus()}};te.prototype._findNextFocusTargetAfterDelete=function(e){if(!this.oManagementTable||!e){return this.oManagementCancel}const t=this.oManagementTable.getItems();const i=e.getKey();let a=-1;for(let e=0;e<t.length;e++){const s=t[e];if(s.getVisible()){const t=s.getBindingContext("$mVariants");if(t){const s=t.getObject();if(s&&s.getKey()===i){a=e;break}}}}if(a===-1){return this.oManagementCancel}let s=ae(t,a+1,t.length,1);if(s){return s}s=ae(t,a-1,-1,-1);if(s){return s}return this.oManagementCancel};function ae(e,t,i,a){for(let s=t;a>0?s<i:s>i;s+=a){const t=e[s];if(t&&t.getVisible()){const e=t.getBindingContext("$mVariants");if(e){const i=e.getObject();if(i){return t}}}}return null}te.prototype._collectManageData=function(){var e={};var t=this.getDefaultKey();if(t!==this._sOriginalDefaultKey){e.def=t}this.getItems().forEach(function(t){const i=this._isItemDeleted(t);if(i){if(!e.deleted){e.deleted=[]}e.deleted.push(t.getKey())}if(!i&&t.getFavorite()!==t._getOriginalFavorite()){if(!e.fav){e.fav=[]}e.fav.push({key:t.getKey(),visible:t.getFavorite()});t._setOriginalFavorite(t.getFavorite())}if(!i&&t.getTitle()!==t._getOriginalTitle()){if(!e.renamed){e.renamed=[]}e.renamed.push({key:t.getKey(),name:t.getTitle()});t._setOriginalTitle(t.getTitle())}if(!i&&t.getExecuteOnSelect()!==t._getOriginalExecuteOnSelect()){if(!e.exe){e.exe=[]}e.exe.push({key:t.getKey(),exe:t.getExecuteOnSelect()});t._setOriginalExecuteOnSelect(t.getExecuteOnSelect())}if(!i&&this._hasContextsChanged(t)){if(!e.contexts){e.contexts=[]}e.contexts.push({key:t.getKey(),contexts:t.getContexts()});t._setOriginalContexts(t.getContexts())}}.bind(this));return e};te.prototype._resetToOriginal=function(){this.getItems().forEach(function(e){e.setTitle(e._getOriginalTitle());e.setFavorite(e._getOriginalFavorite());e.setExecuteOnSelect(e._getOriginalExecuteOnSelect());e.setContexts(e._getOriginalContexts())})};te.prototype._hasContextsChanged=function(e){return JSON.stringify(e.getContexts())!==JSON.stringify(e._getOriginalContexts())};te.prototype._handleManageSavePressed=function(){if(this._anyInErrorState(this.oManagementTable)){return false}if(this._getDeletedItems().length>0){this._bRebindRequired=true}if(this._getRenamedItems().length>0){this._bRebindRequired=true;if(this._getRenamedItems().indexOf(this.getSelectedKey())>=0){var e=this.oVariantText.getBinding("text");if(e){e.checkUpdate(true)}}}if(this._bRebindRequired){this.oManagementTable.unbindItems()}this.fireManage(this._collectManageData());if(this.oManagementDialog){this._resumeManagementTableBinding()}return true};te.prototype._resumeManagementTableBinding=function(){if(this.oManagementTable){var e=this.oManagementTable.getBinding("items");if(e){e.resume()}}};te.prototype._suspendManagementTableBinding=function(){if(this.oManagementTable){var e=this.oManagementTable.getBinding("items");if(e){e.suspend()}}};te.prototype._focusOnFirstInputInErrorState=function(e){if(e){e.getItems().some(function(e){var t=e.getCells()[te.COLUMN_NAME_IDX];if(t&&t.getValueState&&t.getValueState()===J.Error){t.getDomRef().scrollIntoView();t.focus();return true}return false})}};te.prototype._isItemDeleted=function(e){const t=this._getDeletedItems();if(!e||!t){return false}return t.indexOf(e.getKey())>-1};te.prototype._anyInErrorStateManageTable=function(e){var t=false;if(e){e.getItems().some(function(e){if(e.getVisible()){var i=e.getCells()[te.COLUMN_NAME_IDX];if(i&&i.getValueState&&i.getValueState()===J.Error){t=true}}return t})}return t};te.prototype._anyInErrorState=function(e){if(this._anyInErrorStateManageTable(e)){return true}var t=this._getRenamedItems();for(var i=t.length-1;i>=0;i--){var a=this._getItemByKey(t[i]);if(a){if(a.getTitle()===a._getOriginalTitle()){this._removeRenamedItem(a)}}}var s=false;this._getRenamedItems().some(function(e,t){var i=this._getItemByKey(e);if(i){s=this._checkIsDuplicateInModel(i.getTitle(),e)}return s}.bind(this));if(s){this._oSearchFieldOnMgmtDialog.setValue("");this._triggerSearchInManageDialogByValue("",e);this._focusOnFirstInputInErrorState(e)}return s};te.prototype._getRowForKey=function(e){let t=null;if(this.oManagementTable){this.oManagementTable.getItems().some(function(i){const a=i.getCells()[0].getParent();const s=a.getBindingContext(this._sModelName);const n=this._findVariantItem(s);if(e===n.getKey()){t=i}return t!==null}.bind(this))}return t};te.prototype._determineIndex=function(e){var t=-1;var i=e.lastIndexOf("/");if(i>0){t=parseInt(e.substring(i+1))}return t};te.prototype._getFilters=function(e){var t=[];if(e){t.push(e)}t.push(this._getVisibleFilter());if(this.getSupportFavorites()){t.push(this._getFavoriteFilter())}return t};te.prototype._getVisibleFilter=function(){return new n({path:"visible",operator:o.EQ,value1:true})};te.prototype._getFavoriteFilter=function(){return new n({path:"favorite",operator:o.EQ,value1:true})};te.prototype._verifyVariantNameConstraints=function(e,t,i){if(!e){return}var a=i||e.getValue();a=a.trim();if(!this._checkIsDuplicate(a,t)){if(a===""){e.setValueState(J.Error);e.setValueStateText(this._oRb.getText("VARIANT_MANAGEMENT_ERROR_EMPTY"))}else if(a.indexOf("{")>-1){e.setValueState(J.Error);e.setValueStateText(this._oRb.getText("VARIANT_MANAGEMENT_NOT_ALLOWED_CHAR",["{"]))}else if(a.length>te.MAX_NAME_LEN){e.setValueState(J.Error);e.setValueStateText(this._oRb.getText("VARIANT_MANAGEMENT_MAX_LEN",[te.MAX_NAME_LEN]))}else{e.setValueState(J.None);e.setValueStateText(null)}}else{e.setValueState(J.Error);if(this._oSearchFieldOnMgmtDialog&&this._oSearchFieldOnMgmtDialog.getValue()){e.setValueStateText(this._oRb.getText("VARIANT_MANAGEMENT_ERROR_DUPLICATE_SAVE"))}else{e.setValueStateText(this._oRb.getText("VARIANT_MANAGEMENT_ERROR_DUPLICATE"))}}};te.prototype._checkVariantNameConstraints=function(e,t){this._verifyVariantNameConstraints(e,t);if(this.oManagementDialog&&this.oManagementDialog.isOpen()){this._reCheckVariantNameConstraints()}};te.prototype._reCheckVariantNameConstraints=function(){let e;let t=false;if(this.oManagementTable){e=this.oManagementTable.getItems();e.some(function(e){const i=this._findVariantItem(e.getBindingContext(this._sModelName));if(i&&i.getVisible()){var a=e.getCells()[te.COLUMN_NAME_IDX];if(a&&a.getValueState&&a.getValueState()===J.Error){this._verifyVariantNameConstraints(a,i.getKey());if(a.getValueState()===J.Error){t=true}}}return t}.bind(this))}return t};te.prototype._checkIsDuplicate=function(e,t){if(this.oManagementDialog&&this.oManagementDialog.isOpen()){var i=this._checkIsDuplicateInManageTable(e,t);if(this._oSearchFieldOnMgmtDialog&&this._oSearchFieldOnMgmtDialog.getValue()&&i){return i}}return this._checkIsDuplicateInModel(e,t)};te.prototype._checkIsDuplicateInModel=function(e,t){var i=false;var a=this._getItems();var s=e.toLowerCase();a.some(function(e){if(e.getTitle().toLowerCase()===s){if(t&&t===e.getKey()){return false}i=true}return i});return i};te.prototype._checkIsDuplicateInManageTable=function(e,t){let i;let a=false;const s=e.toLowerCase();if(this.oManagementTable){i=this.oManagementTable.getItems();i.some(e=>{let i;const n=e.getBindingContext(this._sModelName).getObject();if(n?.visible){var o=e.getCells()[te.COLUMN_NAME_IDX];if(o&&n.key!==t){if(o.isA("sap.m.Input")){i=o.getValue().toLowerCase()}else{i=o.getTitle().toLowerCase()}if(i===s){a=true}}}return a})}return a};te.prototype._getToolbarInteractive=function(){return true};te.prototype._rebindVMTable=function(e){const t=this.getBindingInfo("items")??{path:"/items",model:"$mVariants",factory:this._templateFactoryManagementDialog.bind(this),filters:this._getVisibleFilter()};if(!this.oManagementTable.getBinding("items")||e){const e=Object.assign({},{path:t.path,model:t.model,parameters:t.parameters},{factory:this._templateFactoryManagementDialog.bind(this),filters:this._getVisibleFilter()});this._sModelName=e.model;this.oManagementTable.bindAggregation("items",e)}else{this.oManagementTable.getBinding("items").filter(this._getVisibleFilter())}this._bRebindRequired=false};te.prototype._findVariantItem=function(e){const t=e.getObject();if(t.isA?.("sap.m.VariantItem")){return t}return this.getItems().find(e=>e.getKey()===t.key)};te.prototype._createRolesCell=function(e,t,i=`${this.getId()}-manage`){const a=function(e){const t=e.oSource.getBindingContext(this._sModelName);const i=this._findVariantItem(t);this._openRolesDialog(i,e.oSource.getParent().getItems()[0])}.bind(this);if(this._sStyleClass&&this.getSupportContexts()&&e.getKey()!==this.getStandardVariantKey()){const n=this._determineIndex(t.getPath());const o=new T({wrapping:false});this._determineRolesSpecificText(e,o);var s=new u({src:"sap-icon://edit",press:a});s.addStyleClass("sapMVarMngmtRolesEdit");s.setTooltip(this._oRb.getText("VARIANT_MANAGEMENT_VISIBILITY_ICON_TT"));return new L(i+"-role-"+n,{items:[o,s]})}else{return new T}};te.prototype._updateContextsDependencies=function(e){const t=e.getBindingContext(this._sModelName);const i=this._findVariantItem(t);const a=e.removeCell(te.COLUMN_ROLES_IDX);a?.destroy();const s=this._createRolesCell(this._findVariantItem(t),t);e.insertCell(s,te.COLUMN_ROLES_IDX);if(s.isA("sap.m.HBox")&&this._isRestricted(i.getContexts())){const t=e.getCells()[te.COLUMN_DEFAULT_IDX];t.setEnabled(false);if(this.getDefaultKey()===i.getKey()){this.setDefaultKey(this.getStandardVariantKey())}}};te.prototype.exit=function(){var e;this._oObserver.disconnect();this._oObserver=undefined;g.prototype.exit.apply(this,arguments);this._clearDeletedItems();this._clearRenamedItems();if(this.oVariantInvisibleText&&!this.oVariantInvisibleText._bIsBeingDestroyed){this.oVariantInvisibleText.destroy(true);this.oVariantInvisibleText=undefined}if(this.oVariantListInvisibleText&&!this.oVariantListInvisibleText._bIsBeingDestroyed){this.oVariantListInvisibleText.destroy(true);this.oVariantListInvisibleText=undefined}if(this.oDefault&&!this.oDefault._bIsBeingDestroyed){this.oDefault.destroy()}this.oDefault=undefined;if(this.oPublic&&!this.oPublic._bIsBeingDestroyed){this.oPublic.destroy()}this.oPublic=undefined;if(this.oExecuteOnSelect&&!this.oExecuteOnSelect._bIsBeingDestroyed){this.oExecuteOnSelect.destroy()}this.oExecuteOnSelect=undefined;if(this.oCreateTile&&!this.oCreateTile._bIsBeingDestroyed){this.oCreateTile.destroy()}this.oCreateTile=undefined;this._oRb=undefined;this.oVariantList=undefined;this.oVariantSelectionPage=undefined;this.oVariantLayout=undefined;this.oVariantText=undefined;this.oVariantModifiedText=undefined;this.oVariantPopoverTrigger=undefined;this._oSearchField=undefined;this._oSearchFieldOnMgmtDialog=undefined;this._sDefaultKey=undefined;this._oCtrlRef=undefined;if(this._oVMTableModel){this._oVMTableModel.destroy();this._oVMTableModel=undefined}if(this._oNoDataIllustratedMessage&&!this._oNoDataIllustratedMessage.bIsDestroyed){this._oNoDataIllustratedMessage.destroy()}if(this._oNoDataFoundIllustratedMessage&&!this._oNoDataFoundIllustratedMessage.bIsDestroyed){this._oNoDataFoundIllustratedMessage.destroy()}this._oNoDataIllustratedMessage=undefined;this._oNoDataFoundIllustratedMessage=undefined;e=this.getModel(te.INNER_MODEL_NAME);if(e){e.destroy()}if(this._oManagedObjectModel){this._oManagedObjectModel.destroy();this._oManagedObjectModel=undefined}this._oRolesComponentContainer=null;if(this._oRolesDialog&&!this._oRolesDialog._bIsBeingDestroyed){this._oRolesDialog.destroy();this._oRolesDialog=null}};return te});
//# sourceMappingURL=VariantManagement.js.map